<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google" content="notranslate" /> 
    <title>LEVIATHAN - Deep Sea Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* --- PALETTE ABISSO EVOLUTA --- */
            --primary: #00f2ff; /* Ciano Bioluminescente */
            --primary-dim: rgba(0, 242, 255, 0.15);
            --secondary: #7000ff; /* Viola Abisso */
            --accent: #00457C;
            --gold: #ffcc00; /* Per i trailer, ENG mode e STELLA */
            --bg-deep: #000205; /* Nero quasi assoluto */
            --text-main: #e0f7fa;
            --text-dim: #8baac2;
            --error: #ff3366;
            --success: #00ff9d;
            --glow-strong: 0 0 10px rgba(0, 242, 255, 0.3);
            --glow-intense: 0 0 20px rgba(0, 242, 255, 0.4);
        }
        /* --- BASE & SCROLLBAR --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        html { scroll-behavior: smooth; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; box-shadow: var(--glow-strong); }
        ::selection { background: var(--primary); color: #000; }
        
        body {
            font-family: 'Outfit', sans-serif; margin: 0; background-color: var(--bg-deep); color: var(--text-main);
            min-height: 100vh; display: flex; justify-content: center; align-items: center; overflow-x: hidden; position: relative;
        }

        .ocean-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 50% 10%, rgba(0, 242, 255, 0.08) 0%, rgba(112, 0, 255, 0.05) 30%, transparent 60%),
                radial-gradient(circle at 20% 80%, rgba(0, 242, 255, 0.06) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(112, 0, 255, 0.04) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(0, 242, 255, 0.1) 0%, #00050a 50%, #000000 100%);
            z-index: -5; transform: translate3d(0,0,0);
        }
        
        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -2; overflow: hidden; transform: translate3d(0,0,0); }
        .particle {
            position: absolute; background: radial-gradient(circle, var(--primary) 20%, transparent); border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 242, 255, 0.3); opacity: 0; animation: floatUp 20s linear infinite; will-change: transform, opacity;
        }
        @keyframes floatUp {
            0% { transform: translateY(120vh) scale(0.5) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; } 90% { opacity: 0.5; }
            100% { transform: translateY(-20vh) scale(1.2) rotate(360deg); opacity: 0; }
        }
        
        .main-wrapper { width: 100%; max-width: 1400px; padding: 30px; position: relative; z-index: 1; margin: 60px 0; }
        
        header { text-align: center; margin-bottom: 60px; position: relative; }
        
        .logo-container {
            width: 220px; height: 220px; margin: 0 auto 25px; border-radius: 50%; border: 4px solid rgba(0, 242, 255, 0.7);
            display: flex; align-items: center; justify-content: center; box-shadow: var(--glow-intense), inset 0 0 30px rgba(112, 0, 255, 0.2);
            position: relative; animation: breathe 4s infinite ease-in-out; background: rgba(0, 5, 10, 0.95); overflow: hidden; will-change: transform, box-shadow;
        }
        @keyframes breathe { 0%, 100% { transform: scale(1); box-shadow: var(--glow-intense); } 50% { transform: scale(1.03); box-shadow: var(--glow-strong); } }
        
        .logo-image {
            width: 85%; height: 85%; object-fit: contain; border-radius: 50%; filter: drop-shadow(0 0 15px var(--primary)) brightness(1.2);
            animation: pulseGlow 2s infinite alternate; will-change: filter;
        }
        @keyframes pulseGlow { 0% { filter: drop-shadow(0 0 10px var(--primary)) brightness(1.1); } 100% { filter: drop-shadow(0 0 15px var(--primary)) brightness(1.3); } }
        
        .logo-particles { position: absolute; top: -50px; left: -50px; width: 320px; height: 320px; pointer-events: none; z-index: -1; overflow: hidden; }
        .logo-particle {
            position: absolute; background: radial-gradient(circle, var(--secondary) 20%, transparent); border-radius: 50%;
            box-shadow: var(--glow-strong); opacity: 0; animation: logoFloat 12s linear infinite;
        }
        @keyframes logoFloat {
            0% { transform: translateY(100%) scale(0.8) rotate(0deg); opacity: 0; }
            10% { opacity: 0.4; } 90% { opacity: 0.4; }
            100% { transform: translateY(-100%) scale(1.2) rotate(180deg); opacity: 0; }
        }

        .brand-title {
            font-family: 'Rajdhani', sans-serif; font-size: 7rem; font-weight: 800; margin: 0; line-height: 0.85; text-transform: uppercase; letter-spacing: -5px;
            background: linear-gradient(180deg, #fff 0%, var(--primary) 40%, var(--secondary) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 20px rgba(0, 242, 255, 0.4); animation: textGlow 3s infinite alternate;
        }
        @keyframes textGlow { 0% { filter: drop-shadow(0 0 15px rgba(0, 242, 255, 0.3)); } 100% { filter: drop-shadow(0 0 25px rgba(0, 242, 255, 0.5)); } }
          
        .brand-subtitle {
            font-family: 'Rajdhani', sans-serif; font-size: 1.4rem; letter-spacing: 10px; color: var(--primary); text-transform: uppercase; margin-top: 10px; font-weight: 700;
            display: inline-flex; align-items: center; justify-content: center; text-shadow: 0 0 10px rgba(0, 242, 255, 0.4);
        }
        .brand-subtitle::before, .brand-subtitle::after {
            content: ''; display: block; width: 40px; height: 2px; background: linear-gradient(90deg, transparent, var(--primary)); margin: 0 20px; box-shadow: 0 0 5px var(--primary); opacity: 0.8;
        }
        .brand-subtitle::after { transform: rotate(180deg); }
        .logo-desc { font-family: 'Outfit', sans-serif; font-size: 1rem; color: var(--text-dim); margin: 5px 0 10px; text-shadow: 0 0 5px rgba(0, 242, 255, 0.3); opacity: 0.8; }
        .version-badge {
            display: inline-block; margin-top: 10px; padding: 5px 18px; background: rgba(0, 0, 0, 0.6); border: 1px solid var(--primary); border-radius: 20px;
            color: var(--primary); font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1rem; letter-spacing: 2px; box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
            position: relative; overflow: hidden; animation: badgePulse 4s infinite ease-in-out;
        }
        .version-badge::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 200%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 242, 255, 0.3), transparent); transform: skewX(-30deg); animation: badgeShine 5s infinite linear;
        }
        @keyframes badgePulse { 0%, 100% { box-shadow: 0 0 10px rgba(0, 242, 255, 0.1); border-color: rgba(0, 242, 255, 0.5); } 50% { box-shadow: 0 0 15px rgba(0, 242, 255, 0.3); border-color: var(--primary); } }
        @keyframes badgeShine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }

        .glass-panel {
            background: linear-gradient(160deg, rgba(2, 12, 20, 0.85), rgba(0, 0, 0, 0.95)); border: 1px solid rgba(0, 242, 255, 0.2); border-radius: 25px; padding: 40px; margin-bottom: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.7), inset 0 0 20px rgba(0, 242, 255, 0.05); position: relative; overflow: hidden; animation: panelEnter 1s ease-out; transform: translate3d(0,0,0);
        }
        @keyframes panelEnter { 0% { opacity: 0; transform: translateY(50px); } 100% { opacity: 1; transform: translateY(0); } }
        
        .glass-panel::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 242, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 242, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px; opacity: 0.3; pointer-events: none; mask-image: radial-gradient(circle at center, black, transparent 85%);
        }
        .panel-header { border-bottom: 1px solid rgba(0, 242, 255, 0.25); padding-bottom: 20px; margin-bottom: 30px; display: flex; align-items: center; gap: 20px; }
        .panel-title { font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 700; color: #fff; text-transform: uppercase; letter-spacing: 3px; text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
        
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .info-card {
            background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.15); padding: 25px; border-radius: 15px; display: flex; gap: 20px; align-items: flex-start;
            transition: 0.3s ease; position: relative; overflow: hidden;
        }
        .info-card:hover { background: rgba(0, 242, 255, 0.08); box-shadow: 0 0 15px rgba(0, 242, 255, 0.1); transform: translateY(-3px) scale(1.01); }
        .info-icon { font-size: 1.8rem; color: var(--primary); margin-top: 5px; filter: drop-shadow(0 0 5px var(--primary)); transition: transform 0.3s; }
        .info-card:hover .info-icon { transform: rotate(180deg); }
        .info-text h4 { margin: 0 0 8px 0; font-family: 'Rajdhani', sans-serif; font-size: 1.2rem; text-transform: uppercase; }
        .info-text p { margin: 0; font-size: 1rem; color: var(--text-dim); line-height: 1.5; }
        
        .service-tabs { display: flex; gap: 15px; margin-bottom: 35px; background: rgba(0,0,0,0.4); padding: 8px; border-radius: 20px; box-shadow: inset 0 0 10px rgba(0,0,0,0.3); }
        .service-tab {
            flex: 1; text-align: center; padding: 18px; cursor: pointer; border-radius: 15px; border: 1px solid transparent; transition: 0.3s ease; color: var(--text-dim);
            font-family: 'Rajdhani', sans-serif; font-weight: 700; letter-spacing: 1.5px; display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .service-tab:hover { color: #fff; background: rgba(255,255,255,0.05); transform: scale(1.03); }
        .service-tab.active {
            background: linear-gradient(135deg, rgba(0, 242, 255, 0.15), rgba(112, 0, 255, 0.15)); border-color: var(--primary); color: #fff;
            box-shadow: inset 0 0 10px rgba(0, 242, 255, 0.1), 0 0 10px rgba(0, 242, 255, 0.2);
        }
        .service-tab.p2p-active {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.15), rgba(255, 100, 0, 0.15)) !important;
            border-color: var(--gold) !important;
            color: #fff !important;
            box-shadow: inset 0 0 10px rgba(255, 204, 0, 0.1), 0 0 10px rgba(255, 204, 0, 0.2) !important;
        }
        .tab-icon { font-size: 2rem; display: block; transition: transform 0.4s ease; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
        .service-tab:hover .tab-icon { transform: scale(1.1); filter: drop-shadow(0 0 8px var(--primary)); }
        
        /* --- INPUTS --- */
        .input-group { position: relative; margin-bottom: 30px; }
        .custom-input {
            width: 100%; 
            background-color: #02060a !important;
            background-image: 
                linear-gradient(rgba(0, 242, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            
            border: 1px solid rgba(0, 242, 255, 0.2); 
            padding: 22px; padding-right: 170px;
            border-radius: 12px; color: var(--primary); 
            font-family: 'Rajdhani', monospace; font-size: 1.2rem; font-weight: 700; letter-spacing: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #02060a inset !important;
            -webkit-text-fill-color: var(--primary) !important;
            transition: background-color 5000s ease-in-out 0s;
        }

        .custom-input:focus, .custom-input:not(:placeholder-shown) {
            border-color: var(--primary); 
            background-color: #02060a !important;
            color: #fff;
            text-shadow: 0 0 5px rgba(0, 242, 255, 0.3); 
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1), inset 0 0 30px rgba(0, 242, 255, 0.05); 
            transform: translateY(-1px);
        }
        .custom-input::placeholder { color: rgba(139, 170, 194, 0.3); font-weight: 500; letter-spacing: 1px; }
        
        .custom-input:disabled, .custom-input.disabled-input {
            opacity: 0.4; cursor: not-allowed; filter: grayscale(1); border-color: #333; box-shadow: none; color: #555;
        }

        .custom-input.input-error { border-color: var(--error); box-shadow: 0 0 10px rgba(255, 51, 102, 0.2); color: var(--error); }
        .input-action {
            position: absolute; right: 8px; top: 8px; bottom: 8px; background: linear-gradient(135deg, rgba(0, 242, 255, 0.1), rgba(112, 0, 255, 0.1));
            border: 1px solid rgba(0, 242, 255, 0.3); color: var(--primary); padding: 0 20px; display: flex; align-items: center; gap: 10px;
            border-radius: 8px; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.95rem; text-decoration: none; transition: 0.3s ease; cursor: pointer; text-transform: uppercase;
        }
        .input-action:hover { background: var(--primary); color: #000; box-shadow: var(--glow-strong); transform: scale(1.03); }
        .error-msg { position: absolute; bottom: -25px; left: 15px; color: var(--error); font-size: 0.9rem; opacity: 0; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; font-weight: 700; transition: opacity 0.3s; }
        .custom-input.input-error + .error-msg, .custom-input.input-error + .input-action + .error-msg { opacity: 1; }
        .ad-warning-msg { color: var(--warning); font-size: 0.9rem; margin-top: 10px; display: none; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; font-weight: 700; padding-left: 15px; text-shadow: 0 0 5px rgba(255, 204, 0, 0.2); }
        
        .module-box {
            border: 1px solid rgba(112, 0, 255, 0.2); background: linear-gradient(135deg, rgba(0, 5, 10, 0.6), rgba(112, 0, 255, 0.05));
            border-radius: 20px; padding: 25px; margin-top: 30px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: all 0.3s ease;
        }
        .module-box:hover { border-color: rgba(112, 0, 255, 0.4); box-shadow: 0 0 15px rgba(112, 0, 255, 0.1); }
        .module-label {
            position: absolute; top: -14px; left: 20px; background: #000; color: var(--text-dim);
            font-family: 'Rajdhani', sans-serif; font-weight: 800; padding: 2px 15px; border: 1px solid rgba(112, 0, 255, 0.3);
            letter-spacing: 2px; font-size: 0.8rem; border-radius: 5px; text-transform: uppercase;
        }
        .control-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .control-row:last-child { border-bottom: none; }
        .control-title { font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.15rem; color: #fff; display: flex; align-items: center; gap: 12px; }
        .control-desc { display: block; font-size: 0.9rem; color: var(--text-dim); margin-top: 5px; font-weight: 300; line-height: 1.4; max-width: 90%; }
        .control-info { flex: 1; padding-right: 15px; min-width: 0; }
        
        .switch { position: relative; width: 55px; height: 28px; flex-shrink: 0; margin-left: 10px;}
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #1a1a1a; transition: .3s; border-radius: 34px; border: 1px solid #333; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 3px; background-color: #888; transition: .3s; border-radius: 50%; box-shadow: 0 0 3px rgba(0,0,0,0.3); }
        input:checked + .slider { background-color: rgba(0, 242, 255, 0.25); border-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(25px); background-color: var(--primary); box-shadow: var(--glow-strong); }
        .mf-switch input:checked + .slider { border-color: var(--secondary); background-color: rgba(112,0,255,0.25); }
        .mf-switch input:checked + .slider:before { background-color: var(--secondary); box-shadow: 0 0 10px var(--secondary); }
        .mf-group { display: grid; gap: 15px; margin-top: 15px; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border: 1px dashed rgba(255,255,255,0.1); }
        .mf-input { background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.15); padding: 12px; color: #fff; width: 100%; border-radius: 8px; font-family: 'Outfit', sans-serif; transition: 0.3s; font-size: 0.95rem;}
        .mf-input:focus { border-color: var(--secondary); outline: none; box-shadow: 0 0 10px rgba(112,0,255,0.2); }

        .sub-row { display: none; background: rgba(0,0,0,0.3); border-bottom: 1px solid rgba(255,255,255,0.05); padding: 12px 15px; margin-bottom: 10px; border-radius: 8px; animation: fadeInRow 0.3s ease; }
        @keyframes fadeInRow { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .sc-quality-container { display: none; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 0 0 10px 10px; margin-top: -10px; margin-bottom: 15px; border-left: 2px solid var(--secondary); border-right: 2px solid var(--secondary); border-bottom: 2px solid rgba(112,0,255,0.3); animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
        .quality-label { font-family: 'Rajdhani', sans-serif; font-size: 0.8rem; color: #aaa; margin-bottom: 8px; text-transform: uppercase; text-align: center; }
        .quality-grid { display: flex; gap: 8px; justify-content: center; }
        .q-btn { flex: 1; padding: 8px 4px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: var(--text-dim); text-align: center; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.8rem; cursor: pointer; border-radius: 6px; text-transform: uppercase; }
        .q-btn:hover { background: rgba(255,255,255,0.1); }
        .q-btn.active { background: rgba(112, 0, 255, 0.2); border-color: var(--secondary); color: #fff; box-shadow: 0 0 5px rgba(112, 0, 255, 0.2); }

        /* --- UPDATED TAGS (MFP & NO PROXY) --- */
        .proxy-tag {
            display: inline-block; padding: 3px 8px; margin-left: 8px;
            border-radius: 4px; 
            font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 0.7rem; letter-spacing: 1px;
            text-transform: uppercase; vertical-align: middle;
            transition: 0.3s;
        }
        
        /* MFP Style (Cool, Purple/Secondary theme) */
        .tag-mfp {
            background: rgba(112, 0, 255, 0.15);
            border: 1px solid var(--secondary);
            color: #dbb8ff;
            text-shadow: 0 0 5px var(--secondary);
            box-shadow: inset 0 0 5px rgba(112, 0, 255, 0.1);
        }
        
        /* NO PROXY Style (Clean, Technical, Ghostly) */
        .tag-noproxy {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-dim);
        }

        .section-header { margin: 50px 0 25px; font-family: 'Rajdhani', sans-serif; font-size: 1.4rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 4px; border-left: 4px solid var(--primary); padding-left: 20px; text-shadow: 0 0 10px var(--primary-dim); }
        
        .spectrum-container { background: rgba(0, 5, 10, 0.6); border: 1px solid rgba(0, 242, 255, 0.15); border-radius: 15px; padding: 20px; position: relative; overflow: hidden; margin-bottom: 20px; }
        .spectrum-header { font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .spectrum-desc { display: block; font-size: 0.85rem; color: var(--text-dim); text-transform: none; letter-spacing: 0.5px; margin-top: 4px; font-weight: 400; opacity: 0.8; }
        .spectrum-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .spec-btn { background: rgba(0, 242, 255, 0.05); border: 1px solid var(--primary); color: #fff; padding: 12px 5px; text-align: center; border-radius: 8px; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1rem; transition: 0.3s; position: relative; box-shadow: 0 0 5px rgba(0, 242, 255, 0.05); text-transform: uppercase; }
        .spec-btn:hover { background: rgba(0, 242, 255, 0.1); transform: translateY(-2px); }
        .spec-btn.active { background: linear-gradient(135deg, rgba(0, 242, 255, 0.1), transparent); color: var(--primary); text-shadow: 0 0 5px var(--primary); }
        .spec-btn.excluded { background: rgba(20, 0, 5, 0.6); border-color: var(--error); color: var(--error); opacity: 0.6; text-decoration: line-through; box-shadow: none; }
        #flux-info-box { transition: opacity 0.2s ease-in-out; }
        .spec-btn i { margin-right: 8px; }

        .filter-unit {
            background: linear-gradient(145deg, rgba(5, 10, 20, 0.9), rgba(0, 0, 0, 0.95));
            border: 1px solid rgba(112, 0, 255, 0.25); border-radius: 16px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(112, 0, 255, 0.05);
            position: relative; margin-bottom: 25px; overflow: hidden;
        }
        .filter-unit::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
            animation: borderFlow 5s infinite linear; background-size: 200% 100%;
        }
        @keyframes borderFlow { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
        
        .unit-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .unit-title {
            font-family: 'Rajdhani', sans-serif; font-size: 1.3rem; font-weight: 800; color: #fff; letter-spacing: 2px;
            text-transform: uppercase; display: flex; align-items: center; gap: 10px;
        }
        .filter-row { margin-bottom: 35px; } 
        .filter-row:last-child { margin-bottom: 0; }
        
        .header-with-desc { margin-bottom: 15px; }
        .f-label {
            font-family: 'Rajdhani', sans-serif; font-size: 0.95rem; color: var(--secondary); font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px; display: block;
        }
        .f-desc-mini {
            display: block; font-size: 0.8rem; color: var(--text-dim); margin-top: 3px;
        }

        .gate-integrated { display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); }
        .gate-val-box {
            min-width: 50px; text-align: center; font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1.3rem;
            color: var(--secondary); text-shadow: 0 0 5px rgba(112, 0, 255, 0.3);
        }
        .gate-slider-new {
            -webkit-appearance: none; width: 100%; height: 6px; background: #222; border-radius: 5px; outline: none; flex-grow: 1; border: 1px solid #333;
        }
        .gate-slider-new::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #111; cursor: pointer; transition: 0.2s;
            border: 2px solid var(--secondary); box-shadow: 0 0 10px var(--secondary);
        }
        .gate-integrated:hover .gate-slider-new::-webkit-slider-thumb { transform: scale(1.1); background: var(--secondary); }
        
        .limiter-style .gate-val-box { color: var(--primary); text-shadow: 0 0 5px rgba(0, 242, 255, 0.3); }
        .limiter-style .gate-slider-new::-webkit-slider-thumb { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .limiter-style:hover .gate-slider-new::-webkit-slider-thumb { background: var(--primary); }

        .aux-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px; 
            margin-top: 30px; 
        }

        .aux-card {
            background: rgba(5, 5, 5, 0.8);
            border: 1px solid #333;
            border-radius: 8px; 
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%);
        }
        
        .aux-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--text-dim); transition: 0.3s;
        }
        .aux-card.active::before { background: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .aio-card.active::before { background: var(--secondary); box-shadow: 0 0 10px var(--secondary); }
        .cine-card.active::before { background: var(--gold); box-shadow: 0 0 10px var(--gold); }

        .aux-card:hover { transform: translateY(-3px); background: rgba(20, 20, 20, 0.9); border-color: #555; }
        
        .aux-header { 
            display: flex; align-items: center; margin-bottom: 10px; 
            font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 800; 
            color: #fff; text-transform: uppercase; letter-spacing: 1px; 
        }
        .aux-icon { font-size: 1.1rem; margin-right: 10px; color: #555; transition: 0.4s; }
        .aux-card.active .aux-icon { color: var(--primary); text-shadow: 0 0 8px var(--primary); }
        .aio-card.active .aux-icon { color: var(--secondary); text-shadow: 0 0 8px var(--secondary); }
        .cine-card.active .aux-icon { color: var(--gold); text-shadow: 0 0 8px var(--gold); }

        .aux-desc { font-size: 0.8rem; color: #888; line-height: 1.4; margin-bottom: 20px; flex-grow: 1; }
        
        .cyber-switch-container {
            position: relative; width: 100%; height: 40px;
            background: #000; border: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; overflow: hidden;
            border-radius: 4px;
            transition: 0.3s ease;
        }
        .cyber-switch-container input { display: none; }
        .cs-label {
            flex: 1; text-align: center; font-family: 'Rajdhani', sans-serif; 
            font-weight: 700; font-size: 0.8rem; color: #444; z-index: 2; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 1px;
            display: flex; align-items: center; justify-content: center; height: 100%;
        }
        .cs-separator {
            width: 2px; height: 20px; background: #333; z-index: 2;
            box-shadow: 0 0 5px rgba(0,0,0,0.5); transition: 0.3s;
        }
        .cs-fill {
            position: absolute; top: 0; left: 0; width: 50%; height: 100%;
            background: transparent; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.2) 5px, rgba(0,0,0,0.2) 10px);
            opacity: 0.8;
        }
        .cyber-switch-container:hover { border-color: #555; }
        
        .aio-card input:checked + .cyber-switch-container .cs-fill {
            background-color: rgba(112, 0, 255, 0.25); border-left: 3px solid var(--secondary); box-shadow: inset 0 0 15px rgba(112, 0, 255, 0.1); left: 50%;
        }
        .aio-card input:checked + .cyber-switch-container .cs-label-on { color: var(--secondary); text-shadow: 0 0 10px var(--secondary); font-weight: 800; transform: scale(1.1); }
        .aio-card input:checked + .cyber-switch-container { border-color: var(--secondary); box-shadow: 0 0 15px rgba(112, 0, 255, 0.2); }
        .aio-card input:checked + .cyber-switch-container .cs-separator { background: var(--secondary); box-shadow: 0 0 8px var(--secondary); opacity: 0.8; height: 30px; }

        .cine-card input:checked + .cyber-switch-container .cs-fill {
            background-color: rgba(255, 204, 0, 0.25); border-left: 3px solid var(--gold); box-shadow: inset 0 0 15px rgba(255, 204, 0, 0.1); left: 50%;
        }
        .cine-card input:checked + .cyber-switch-container .cs-label-on { color: var(--gold); text-shadow: 0 0 10px var(--gold); font-weight: 800; transform: scale(1.1); }
        .cine-card input:checked + .cyber-switch-container { border-color: var(--gold); box-shadow: 0 0 15px rgba(255, 204, 0, 0.2); }
        .cine-card input:checked + .cyber-switch-container .cs-separator { background: var(--gold); box-shadow: 0 0 8px var(--gold); opacity: 0.8; height: 30px; }

        /* --- CYBER SELECT DROPDOWN (PULITO E FUNZIONALE) --- */
        .select-wrapper {
            position: relative;
            margin-top: auto; 
            width: 100%;
        }
        
        .cyber-select {
            width: 100%;
            background: linear-gradient(145deg, rgba(0,20,30,0.9), rgba(0,0,0,0.9));
            border: 1px solid rgba(0, 242, 255, 0.3);
            color: var(--primary);
            padding: 12px 40px 12px 15px; /* Spazio per freccia */
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cyber-select:hover {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.15);
            color: #fff;
        }

        .cyber-select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.3);
        }

        /* Freccia Personalizzata */
        .select-arrow {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            color: var(--text-dim);
            pointer-events: none;
            transition: 0.3s;
            font-size: 0.9rem;
        }

        .select-wrapper:hover .select-arrow {
            color: var(--primary);
            transform: translateY(-50%) scale(1.2);
        }

        .cyber-select option {
            background: #000;
            color: #fff;
            padding: 10px;
        }

        /* --- VISUAL CORE RESTYLING (FIGHISSIMO) --- */
        .visual-core-hero { 
            margin-bottom: 40px; 
            padding-bottom: 25px; 
            position: relative; 
            margin-top: 40px;
            background: rgba(10, 20, 30, 0.4);
            border: 1px solid rgba(0, 242, 255, 0.15);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 0 50px rgba(0, 242, 255, 0.02);
            border-radius: 20px;
            padding: 30px;
        }
        
        .aio-lock-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 2, 5, 0.85); backdrop-filter: blur(8px);
            z-index: 10; display: none; 
            flex-direction: column; align-items: center; justify-content: center;
            border-radius: 20px; border: 1px solid var(--secondary);
            cursor: pointer;
        }
        .lock-icon { font-size: 3rem; color: var(--secondary); margin-bottom: 15px; filter: drop-shadow(0 0 10px var(--secondary)); }
        .lock-msg { font-family: 'Rajdhani', sans-serif; font-size: 1.5rem; font-weight: 800; color: #fff; letter-spacing: 2px; text-transform: uppercase; }
        
        .disabled-core .skin-selector-container, .disabled-core .custom-area {
            opacity: 0.3; filter: grayscale(1); pointer-events: none;
        }

        /* NEW SKIN SELECTOR GRID */
        .skin-selector-container {
            display: grid; 
            grid-template-columns: repeat(5, 1fr); /* Default desktop */
            gap: 15px; 
            margin-bottom: 25px;
            padding: 10px;
            background: radial-gradient(circle at center, rgba(0, 242, 255, 0.05) 0%, transparent 70%);
        }

        /* NEW SKIN BUTTON STYLE - CYBER PLATE */
        .skin-btn {
            background: rgba(5, 10, 15, 0.8);
            border: 1px solid rgba(255,255,255,0.08);
            color: var(--text-dim);
            padding: 20px 10px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 10px; 
            position: relative; 
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
        }

        /* Hover Effect: Brighten & Lift */
        .skin-btn:hover {
            background: rgba(20, 30, 40, 0.9);
            border-color: rgba(0, 242, 255, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.5), 0 0 15px rgba(0, 242, 255, 0.1);
            color: #fff;
        }
        .skin-btn:hover .skin-icon { transform: scale(1.1) rotate(5deg); filter: drop-shadow(0 0 5px var(--primary)); color: #fff; }

        /* ACTIVE STATE: NEON GLOW */
        .skin-btn.active {
            background: linear-gradient(145deg, rgba(0, 5, 10, 0.95), rgba(0, 20, 40, 0.9));
            border-color: transparent; /* Usiamo pseudo-element per il bordo */
            color: #fff;
            transform: scale(1.05);
            z-index: 2;
            box-shadow: 
                0 0 30px rgba(0, 242, 255, 0.15), 
                inset 0 0 20px rgba(0, 242, 255, 0.1);
        }

        /* Gradient Border trick for Active State */
        .skin-btn.active::before {
            content: ''; position: absolute; inset: 0; border-radius: 12px; padding: 2px; /* Border width */
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--primary));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude;
            animation: borderRotate 4s linear infinite; opacity: 1;
        }
        @keyframes borderRotate { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        /* Bottom glow line for Active */
        .skin-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 15%; width: 70%; height: 3px;
            background: var(--primary);
            box-shadow: 0 0 15px var(--primary), 0 0 30px var(--primary);
            border-radius: 10px 10px 0 0;
            animation: pulseLine 2s infinite alternate;
        }
        @keyframes pulseLine { 0% { opacity: 0.5; width: 60%; } 100% { opacity: 1; width: 80%; } }

        .skin-icon { 
            font-size: 1.8rem; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            color: #666; 
            margin-bottom: 5px;
        }
        .skin-btn.active .skin-icon { 
            color: var(--primary); 
            filter: drop-shadow(0 0 15px var(--primary)); 
            transform: scale(1.2); 
            animation: iconFloat 3s ease-in-out infinite;
        }
        @keyframes iconFloat { 0%, 100% { transform: translateY(0) scale(1.2); } 50% { transform: translateY(-5px) scale(1.2); } }

        .skin-name { 
            font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 0.8rem; 
            text-transform: uppercase; letter-spacing: 2px; z-index: 1; 
            transition: 0.3s;
        }
        .skin-btn.active .skin-name { color: var(--primary); text-shadow: 0 0 10px rgba(0, 242, 255, 0.5); }


        /* NEW PREVIEW TERMINAL STYLE */
        .preview-terminal {
            background: #080808;
            border: 1px solid #222;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            font-family: 'JetBrains Mono', 'Roboto Mono', monospace;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.9);
            /* CRT Texture */
            background-image: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255,0,0,0.03), rgba(0,255,0,0.01), rgba(0,0,255,0.03));
            background-size: 100% 3px, 4px 100%;
        }
        
        /* Scanline Animation */
        .preview-terminal::after {
            content: " ";
            display: block;
            position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.1) 50%, rgba(0, 0, 0, 0.1));
            background-size: 100% 6px;
            z-index: 2;
            pointer-events: none;
            animation: scanlineMove 10s linear infinite;
            opacity: 0.4;
        }
        @keyframes scanlineMove { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }

        /* Subtle Glow Overlay inside terminal */
        .preview-terminal::before {
            content: ""; position: absolute; top:0; left:0; width:100%; height:100%;
            background: radial-gradient(circle at center, rgba(0, 242, 255, 0.03), transparent 80%);
            pointer-events: none; z-index: 1;
        }

        .preview-header {
            font-family: 'Rajdhani', sans-serif; font-size: 0.85rem; color: #555; text-transform: uppercase; letter-spacing: 2px;
            margin-bottom: 20px; border-bottom: 1px solid #222; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
            position: relative; z-index: 3;
        }
        .preview-header i { margin-right: 8px; color: var(--primary-dim); }
        
        #prev-mode-label { 
            color: var(--primary); text-shadow: 0 0 8px rgba(0, 242, 255, 0.5); font-weight: 800; 
            padding: 2px 10px; border: 1px solid rgba(0, 242, 255, 0.3); border-radius: 4px; background: rgba(0, 242, 255, 0.05);
        }

        .stremio-mock-row {
            display: flex; gap: 20px; align-items: flex-start; background: rgba(255,255,255,0.02); padding: 20px; border-radius: 12px;
            transition: 0.2s; cursor: default; border: 1px solid rgba(255,255,255,0.05); position: relative; z-index: 3;
            backdrop-filter: blur(2px);
        }
        .stremio-mock-row:hover { background: rgba(255,255,255,0.05); border-color: var(--primary); box-shadow: 0 0 20px rgba(0, 242, 255, 0.1); }
        
        .mock-poster { 
            width: 55px; height: 82px; background: linear-gradient(to bottom, #252525, #151515); 
            border-radius: 6px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; 
            color: #444; font-size: 1.5rem; border: 1px solid #333; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .mock-content { flex-grow: 1; display: flex; flex-direction: column; gap: 8px; }
        .mock-title { color: #fff; font-size: 1.15rem; font-weight: 500; white-space: pre-wrap; line-height: 1.3; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .mock-info { color: #aaa; font-size: 0.9rem; white-space: pre-wrap; line-height: 1.6; font-weight: 400; font-family: 'Outfit', sans-serif; opacity: 0.9; }
        
        .custom-area {
            display: none; background: #0a0a0a; padding: 0; border-radius: 10px; 
            border: 1px solid #333; margin-top: 15px; animation: fadeInRow 0.3s ease;
            position: relative; overflow: hidden;
        }
        .custom-area::before { content: 'TEMPLATE EDITOR // BASH'; position: absolute; top: 0; right: 0; background: #111; color: #555; padding: 2px 10px; font-size: 0.7rem; font-family: monospace; border-bottom-left-radius: 8px; }
        .custom-area.show { display: block; }
        .custom-input:focus { outline: none; border: none; }
        .custom-helper { 
            background: #0f0f0f; border-top: 1px solid #222; padding: 10px 15px;
            font-size: 0.8rem; color: #666; font-family: 'Rajdhani', sans-serif;
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
        }
        .var-tag { 
            background: rgba(255,255,255,0.05); padding: 2px 6px; border-radius: 4px; 
            color: #aaa; font-family: monospace; cursor: help; border: 1px solid rgba(255,255,255,0.05);
        }
        .var-tag:hover { border-color: var(--primary); color: var(--primary); }

        .action-area { display: flex; gap: 15px; margin-top: 40px; flex-direction: column; }
        .btn-install { flex: 2; background: rgba(0, 242, 255, 0.05); color: var(--primary); border: 1px solid var(--primary); padding: 15px 20px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; font-weight: 800; text-transform: uppercase; letter-spacing: 3px; border-radius: 8px; cursor: pointer; transition: 0.3s ease; position: relative; overflow: hidden; box-shadow: 0 0 10px rgba(0, 242, 255, 0.05); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-install::before { content: ''; position: absolute; top: 0; left: -100%; width: 200%; height: 100%; background: linear-gradient(90deg, transparent, rgba(0, 242, 255, 0.4), transparent); transform: skewX(-30deg); transition: 0.5s ease; }
        .btn-install:hover { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary); transform: translateY(-2px); letter-spacing: 4px; }
        .btn-install:hover::before { left: 100%; }
        .btn-copy { flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; border-radius: 8px; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 700; transition: 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-copy:hover { border-color: #fff; background: rgba(255,255,255,0.1); transform: translateY(-2px); }

        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
        .modal-backdrop.show { opacity: 1; }
        .modal-content { background: linear-gradient(135deg, #020508, #000205); border: 1px solid var(--primary); width: 95%; max-width: 650px; border-radius: 25px; padding: 35px; box-shadow: var(--glow-strong); transform: scale(0.8); transition: 0.3s ease; max-height: 90vh; overflow-y: auto; }
        .modal-backdrop.show .modal-content { transform: scale(1); }
        .modal-title { font-family: 'Rajdhani', sans-serif; font-size: 2rem; color: var(--primary); margin-bottom: 25px; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.15); padding-bottom: 15px; text-shadow: 0 0 10px var(--primary); }
        .modal-list li { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.08); color: var(--text-dim); font-size: 1rem;}
        .modal-list li span { color: #fff; font-family: 'Rajdhani', sans-serif; font-weight: 700; letter-spacing: 1.5px; }
        .modal-btns { display: flex; gap: 15px; margin-top: 30px; }
        .m-btn { flex: 1; padding: 18px; border-radius: 12px; border: none; font-family: 'Rajdhani', sans-serif; font-weight: 700; text-transform: uppercase; cursor: pointer; transition: 0.3s ease; }
        .m-close { background: rgba(255,255,255,0.15); color: #fff; }
        .m-close:hover { background: rgba(255,255,255,0.25); transform: scale(1.03); }
        .m-go { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #000; box-shadow: var(--glow-strong); }
        .m-go:hover { box-shadow: var(--glow-intense); transform: scale(1.03); }
        .faq-item { border-bottom: 1px solid rgba(255,255,255,0.08); padding: 18px 0; transition: background 0.3s; }
        .faq-item:hover { background: rgba(255,255,255,0.03); }
        .faq-q { font-weight: 600; color: #fff; cursor: pointer; display: flex; justify-content: space-between; transition: color 0.3s; }
        .faq-q:hover { color: var(--primary); }
        .faq-a { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; color: var(--text-dim); font-size: 0.95rem; margin-top: 8px; line-height: 1.6; }
        .faq-item.open .faq-a { max-height: 400px; margin-top: 15px; }
        
        .footer-hub { margin-top: 80px; padding-top: 40px; border-top: 1px solid rgba(0, 242, 255, 0.1); position: relative; display: flex; flex-direction: column; align-items: center; gap: 30px; }
        .footer-hub::before { content: 'SYSTEM CORE_'; position: absolute; top: -12px; background: #000205; padding: 0 15px; color: var(--primary-dim); font-family: 'Rajdhani', monospace; letter-spacing: 4px; font-size: 0.8rem; }
        .hub-grid { display: flex; gap: 20px; width: 100%; justify-content: center; flex-wrap: wrap; }
        .hub-card { display: flex; align-items: center; gap: 15px; padding: 15px 25px; border-radius: 16px; text-decoration: none; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.05); min-width: 280px; }
        .hub-card::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(255,255,255,0.05), transparent); transform: translateX(-100%); transition: 0.5s; }
        .hub-card:hover::after { transform: translateX(100%); }
        .hub-card:hover { transform: translateY(-3px); }
        .cmd-card { background: linear-gradient(145deg, rgba(0, 5, 10, 0.8), rgba(0, 242, 255, 0.05)); border-color: rgba(0, 242, 255, 0.2); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); }
        .cmd-card:hover { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 255, 0.1); }
        .cmd-visual { position: relative; width: 50px; height: 50px; }
        .cmd-img { width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }
        .git-badge { position: absolute; bottom: -5px; right: -5px; background: #000; color: #fff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 14px; border: 1px solid var(--primary); box-shadow: 0 0 5px var(--primary); }
        .cmd-data { display: flex; flex-direction: column; }
        .cmd-role { font-family: 'Rajdhani', sans-serif; font-size: 0.75rem; color: var(--primary); letter-spacing: 2px; text-transform: uppercase; }
        .cmd-nick { font-family: 'Rajdhani', sans-serif; font-size: 1.4rem; font-weight: 800; color: #fff; text-shadow: 0 0 5px rgba(0, 242, 255, 0.2); }
        
        /* --- KO-FI CARD STYLE LEVIATHAN (DARK & PURPLE/CYAN) --- */
        .kofi-card { 
            background: linear-gradient(145deg, rgba(5, 0, 10, 0.9), rgba(112, 0, 255, 0.05)); 
            border: 1px solid rgba(112, 0, 255, 0.3); 
            box-shadow: 0 0 15px rgba(112, 0, 255, 0.05); 
        }
        .kofi-card:hover { 
            border-color: var(--secondary); 
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.2), inset 0 0 10px rgba(112, 0, 255, 0.1); 
            transform: translateY(-3px) scale(1.02); 
        }
        .kofi-icon { font-size: 1.8rem; color: var(--secondary); filter: drop-shadow(0 0 5px var(--secondary)); animation: kofiPulse 2s infinite alternate; }
        @keyframes kofiPulse { 0% { opacity: 0.7; text-shadow: 0 0 5px var(--secondary); transform: scale(1); } 100% { opacity: 1; text-shadow: 0 0 15px var(--secondary); transform: scale(1.1); } }
        .kofi-data h4 { margin: 0; font-family: 'Rajdhani', sans-serif; color: #fff; font-size: 1.2rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; background: linear-gradient(90deg, #fff, var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .kofi-data span { font-size: 0.8rem; color: rgba(255, 255, 255, 0.6); letter-spacing: 2px; text-transform: uppercase; }
        .kofi-card:hover .kofi-data span { color: #fff; text-shadow: 0 0 3px var(--secondary); }

        /* --- RATE US CARD (NOW GOLD) --- */
        .rate-card { 
            background: linear-gradient(145deg, rgba(10, 5, 0, 0.9), rgba(20, 10, 0, 0.6));
            border: 1px solid rgba(255, 204, 0, 0.3);
            max-width: 200px; min-width: auto;
            justify-content: center;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.05);
        }
        .rate-card:hover { 
            border-color: var(--gold); 
            background: rgba(255, 204, 0, 0.05); 
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.2);
        }
        .star-icon { color: var(--gold); animation: starSpin 3s infinite linear; font-size: 1.2rem; filter: drop-shadow(0 0 2px var(--gold)); }
        @keyframes starSpin { 0% { transform: rotate(0deg); text-shadow: 0 0 0 var(--gold); } 50% { text-shadow: 0 0 10px var(--gold); } 100% { transform: rotate(360deg); text-shadow: 0 0 0 var(--gold); } }
        .rate-text { font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: #ddd; }
        .rate-card:hover .rate-text { color: #fff; text-shadow: 0 0 5px var(--gold); }

        .signature { font-family: 'Rajdhani', sans-serif; color: rgba(255, 255, 255, 0.2); font-size: 0.8rem; letter-spacing: 3px; text-transform: uppercase; }
        
        .flux-terminal {
            margin-top: 30px;
            background: #000;
            border: 1px solid var(--primary-dim);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.8);
        }
        .flux-header {
            background: rgba(0, 242, 255, 0.05);
            padding: 10px 20px;
            border-bottom: 1px solid rgba(0, 242, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .flux-title {
            font-family: 'Rajdhani', monospace;
            color: var(--primary);
            font-weight: 700;
            letter-spacing: 2px;
            font-size: 0.9rem;
        }
        .live-dot {
            width: 8px; height: 8px; background: #333; border-radius: 50%; display: inline-block; margin-right: 8px;
            transition: 0.3s;
        }
        .flux-terminal.online .live-dot { background: var(--primary); box-shadow: 0 0 8px var(--primary); animation: blinkLive 1s infinite; }
        .flux-terminal.offline .live-dot { background: var(--error); box-shadow: 0 0 5px var(--error); }
        @keyframes blinkLive { 50% { opacity: 0.4; } }
        
        .flux-content { position: relative; }
        .flux-input {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            padding: 20px;
            padding-right: 60px;
            min-height: 85px;
            resize: none;
            line-height: 1.5;
        }
        .flux-input::selection { background: var(--primary); color: #000; }
        .flux-copy-btn {
            position: absolute;
            top: 10px; right: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            color: #aaa;
            width: 35px; height: 35px;
            border-radius: 8px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .flux-copy-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 10px var(--primary); }

        /* --- NEW MICRO-INTERACTIONS & TOASTS --- */
        
        /* 1. AIO DENIED ANIMATION */
        @keyframes shakeGlow {
            0%, 100% { transform: translateX(0); border-color: rgba(112,0,255,0.2); box-shadow: none; }
            20% { transform: translateX(-5px); border-color: var(--secondary); box-shadow: 0 0 20px var(--secondary), inset 0 0 10px var(--secondary); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .denied-anim {
            animation: shakeGlow 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* 2. RECALCULATION OVERLAY */
        .recalc-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center;
            z-index: 10; opacity: 0; pointer-events: none;
            transition: opacity 0.2s;
            backdrop-filter: blur(2px); border-radius: 12px;
        }
        .recalc-overlay.visible { opacity: 1; }
        .recalc-text {
            font-family: 'Rajdhani'; font-weight: 800; color: var(--primary);
            letter-spacing: 2px; text-transform: uppercase; font-size: 1rem;
            display: flex; align-items: center; gap: 10px;
            text-shadow: 0 0 10px var(--primary);
        }

        /* 3. SCI-FI TOAST */
        .sys-toast-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 9999; pointer-events: none; width: 90%; max-width: 400px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .sys-toast {
            background: rgba(5, 10, 15, 0.95);
            border: 1px solid var(--primary);
            border-left: 4px solid var(--primary);
            box-shadow: 0 5px 20px rgba(0,0,0,0.8);
            color: #fff; padding: 15px 20px; border-radius: 8px;
            font-family: 'Rajdhani'; font-size: 1rem; font-weight: 700;
            display: flex; align-items: center; gap: 15px;
            animation: slideUpFade 0.3s ease-out forwards;
            backdrop-filter: blur(5px);
        }
        .sys-toast.warning { border-color: var(--gold); border-left-color: var(--gold); color: var(--gold); }
        .sys-toast.error { border-color: var(--error); border-left-color: var(--error); color: var(--error); }
        .sys-toast.success { border-color: var(--success); border-left-color: var(--success); color: var(--success); }
        
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .sys-toast.out { animation: fadeOut 0.3s ease-out forwards; }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

        /* P2P WARNING STYLE */
        .p2p-active { box-shadow: 0 0 15px rgba(255, 204, 0, 0.15); border-color: var(--gold) !important; }

        @media (min-width: 1024px) {
            .main-wrapper { max-width: 1400px; }
            .desktop-grid-container { 
                display: grid; 
                grid-template-columns: 1fr 1fr; 
                gap: 80px; 
                align-items: start; 
                position: relative; 
            }
            .desktop-grid-container::after {
                content: ''; position: absolute; top: 20px; bottom: 20px; left: 50%; width: 2px;
                background: linear-gradient(to bottom, transparent, var(--primary), var(--secondary), var(--primary), transparent);
                box-shadow: 0 0 15px rgba(0, 242, 255, 0.4); 
                transform: translateX(-50%);
                opacity: 0.8;
                animation: pulseLaser 4s infinite alternate;
            }
            @keyframes pulseLaser { 0% { opacity: 0.5; box-shadow: 0 0 10px rgba(0, 242, 255, 0.2); } 100% { opacity: 1; box-shadow: 0 0 20px rgba(0, 242, 255, 0.6); } }
            
            .action-area { flex-direction: row; }
            
            /* DESKTOP VISUAL CORE */
            .skin-selector-container { grid-template-columns: repeat(5, 1fr); }
            
            .col-left { padding-right: 20px; }
            .col-right { padding-left: 20px; }
        }

        @media (max-width: 768px) {
            header { margin-bottom: 30px; margin-top: 20px; }
            .brand-title { font-size: 3.5rem; letter-spacing: -2px; }
            .logo-container { width: 130px; height: 130px; margin-bottom: 15px; }
            .main-wrapper { margin: 0; padding: 15px; width: 100%; }
            .glass-panel { padding: 20px 15px; border-radius: 20px; margin-bottom: 25px; }
            .info-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .info-card { flex-direction: column; align-items: center; text-align: center; padding: 15px 10px; gap: 10px; height: 100%; }
            .info-text p { display: none; }
            .custom-input { padding: 18px; font-size: 1.1rem; text-align: left; padding-bottom: 50px; padding-right: 18px !important; }
            .input-action { position: absolute; bottom: 6px; left: 6px; right: 6px; top: auto; width: auto; justify-content: center; padding: 10px; font-size: 0.9rem; background: rgba(0, 242, 255, 0.1); border: 1px solid rgba(0, 242, 255, 0.2); }
            .spectrum-grid { grid-template-columns: repeat(2, 1fr); }
            .aux-grid { grid-template-columns: 1fr !important; }
            .skin-selector-container { grid-template-columns: repeat(3, 1fr) !important; }
            .glass-panel, .logo-container, .modal-backdrop { background: rgba(0, 5, 10, 0.98) !important; }
            .particles { display: none !important; } 
            .action-area { flex-direction: column; }
            .service-tabs { display: grid !important; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 8px; }
            .service-tab { padding: 10px 4px; min-width: 0; }
            .hub-grid { flex-direction: column; align-items: stretch; }
            .hub-card { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="ocean-bg"></div>
    <div class="particles" id="particles"></div>
    <div class="main-wrapper">
        <header>
            <div class="logo-container">
                <img src="https://i.ibb.co/j9tSSy7f/Gemini-Generated-Image-xep84gxep84gxep8-Photoroom.png" alt="Leviathan Logo" class="logo-image">
                <div class="logo-particles" id="logoParticles"></div>
            </div>
            <h1 class="brand-title notranslate" translate="no">LEVIATHAN</h1>
            <div class="brand-subtitle notranslate" translate="no">SOVRANO DEGLI ABISSI</div>
            <p class="logo-desc">Il protocollo profondo che domina i flussi digitali</p>
            <div class="version-badge">CORE v2.7.0</div>
        </header>
        <div class="glass-panel">
            <div class="panel-header">
                <i class="fas fa-microchip" style="color:var(--primary)"></i>
                <div class="panel-title">SISTEMI DI BORDO</div>
            </div>
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-bolt"></i></div>
                    <div class="info-text">
                        <h4 class="notranslate" translate="no">Synapse Cache</h4>
                        <p>Aggancio istantaneo ai flussi dati.</p>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-globe-europe"></i></div>
                    <div class="info-text">
                        <h4 class="notranslate" translate="no">Sonar Italiano</h4>
                        <p>Scansione prioritaria audio ITA.</p>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-user-secret"></i></div>
                    <div class="info-text">
                        <h4 class="notranslate" translate="no">Ghost Shell</h4>
                        <p>Mimetizzazione IP attiva.</p>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-spider"></i></div>
                    <div class="info-text">
                        <h4 class="notranslate" translate="no">WebStreamr</h4>
                        <p>Protocollo di Fallback d'Emergenza.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="glass-panel" id="config-area">
            <div class="panel-header">
                <i class="fas fa-sliders-h" style="color:var(--primary)"></i>
                <div class="panel-title">STAZIONE DI COMANDO</div>
            </div>
            
            <div class="desktop-grid-container">
                <div class="col-left">
                    <div class="section-header" style="margin-top:0;">PROTOCOLLI DI CONNESSIONE</div>
                    
                    <div class="service-tabs">
                        <div class="service-tab active" onclick="selectService('rd')">
                            <span class="tab-icon"></span>
                            <span class="tab-name notranslate" translate="no">Real-Debrid</span>
                        </div>
                        <div class="service-tab" onclick="selectService('tb')">
                            <span class="tab-icon"></span>
                            <span class="tab-name notranslate" translate="no">TorBox</span>
                        </div>
                        <div class="service-tab" onclick="selectService('p2p')">
                            <span class="tab-icon"></span>
                            <span class="tab-name notranslate" translate="no">P2P Mode</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <div style="position: relative;">
                            <input type="text" id="apiKey" class="custom-input" placeholder="INSERIRE CHIAVE DEBRID..." oninput="clearError(this); updateFluxStream()">
                            <a href="https://real-debrid.com/apitoken" target="_blank" id="apiLink" class="input-action">
                                <i class="fas fa-key"></i> PRELEVA KEY
                            </a>
                        </div>
                        <span class="error-msg"> Chiave mancante</span>
                    </div>
                    <div class="input-group">
                        <input type="text" id="tmdbKey" class="custom-input" placeholder="CHIAVE TMDB (OPZIONALE)" oninput="clearError(this); updateFluxStream()">
                        <a href="https://www.themoviedb.org/settings/api" target="_blank" class="input-action">
                            <i class="fas fa-database"></i> PRELEVA KEY
                        </a>
                    </div>
                    
                    <div class="module-box" id="webModule">
                        <div class="module-label">MODULO SORGENTI WEB</div>
                        <div class="control-row">
    <div class="control-info">
        <div class="control-title notranslate" translate="no">
            <i class="fas fa-play-circle" style="color: var(--secondary)"></i> StreamingCommunity
            <span class="proxy-tag tag-noproxy">NO PROXY</span>
        </div>
        <span class="control-desc">Accesso diretto ai server di StreamingCommunity. Massima priorit e velocit.</span>
    </div>
    <label class="switch mf-switch"><input type="checkbox" id="enableVix" onchange="checkWebVisibility(); updateFluxStream()"><span class="slider"></span></label>
</div>
                        <div class="sc-quality-container" id="scQualityContainer">
                           <div class="quality-label">Seleziona Qualit Flusso</div>
                            <div class="quality-grid">
                                <div class="q-btn active" id="btnQ_all" onclick="setSCQuality('all')">Hybrid (Tutto)</div>
                                <div class="q-btn" id="btnQ_1080" onclick="setSCQuality('1080')">Solo 1080p</div>
                                <div class="q-btn" id="btnQ_720" onclick="setSCQuality('720')">Solo 720p</div>
                            </div>
                        </div>
                        
                        <div class="control-row">
                            <div class="control-info">
                                <div class="control-title notranslate" translate="no">
                                    <i class="fas fa-film" style="color: #ff9900"></i> GuardaHD 
                                    <span class="proxy-tag tag-mfp">MFP</span>
                                </div>
                                <span class="control-desc">Scraper ibrido Film & Serie TV. Ideale per contenuti in alta definizione.</span>
                            </div>
                            <label class="switch mf-switch"><input type="checkbox" id="enableGhd" onchange="checkWebVisibility(); updateFluxStream()"><span class="slider"></span></label>
                        </div>

                        <div class="control-row">
                            <div class="control-info">
                                <div class="control-title notranslate" translate="no">
                                    <i class="fas fa-tv" style="color: #aa00ff"></i> GuardaSerie
                                    <span class="proxy-tag tag-mfp">MFP</span>
                                </div>
                                <span class="control-desc">Tracker dedicato per Serie TV. Aggiornamento rapido nuovi episodi.</span>
                            </div>
                            <label class="switch mf-switch"><input type="checkbox" id="enableGs" onchange="checkWebVisibility(); updateFluxStream()"><span class="slider"></span></label>
                        </div>

                        <div class="control-row">
                            <div class="control-info">
                                <div class="control-title notranslate" translate="no">
                                    <i class="fas fa-torii-gate" style="color: #ff6600"></i> AnimeWorld
                                    <span class="proxy-tag tag-noproxy">NO PROXY</span>
                                </div>
                                <span class="control-desc">Il pi grande database italiano di Anime. Include gestione Cookie SecurityAW.</span>
                            </div>
                            <label class="switch mf-switch"><input type="checkbox" id="enableAnimeWorld" onchange="checkWebVisibility(); updateFluxStream()"><span class="slider"></span></label>
                        </div>
                        <div class="control-row sub-row" id="webPriorityRow" style="display:none; margin-top:15px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top:10px;">
                             <div class="control-info">
                                 <div class="control-title"><i class="fas fa-sort-amount-down"></i> Gerarchia Sorgenti</div>
                                 <span class="control-desc">Sposta i risultati Web (SC, GHD, GS, AW) dopo i Torrent.</span>
                             </div>
                             <label class="switch mf-switch"><input type="checkbox" id="vixLast" onchange="updateFluxStream()"><span class="slider"></span></label>
                         </div>
                         
                      <div class="control-row" style="margin-top:15px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top:15px;">
                            <div class="control-info">
                                <div class="control-title">
                                    <i class="fas fa-spider" style="color: #fff"></i> WebStreamr Fallback
                                </div>
                                <span class="control-desc">
                                    <strong>Protocollo di Emergenza.</strong> Si attiva in automatico quando non si trovano risultati Debrid.
                                </span>
                            </div>
                            <label class="switch"><input type="checkbox" id="enableWebStreamr" checked onchange="updateFluxStream()"><span class="slider"></span></label>
                        </div>
                    </div>

                    <div class="module-box" id="netModule" style="border-color: rgba(0, 242, 255, 0.3);">
                        <div class="module-label" style="border-color: rgba(0, 242, 255, 0.4); color: var(--primary);">NETWORK BRIDGE</div>
                        <div class="mf-group" style="margin-top:0; border:none; padding:0; background:transparent;">
                            <input type="text" id="mfUrl" class="mf-input" placeholder="URL MediaFlow Proxy" oninput="updateFluxStream()">
                            <input type="password" id="mfPass" class="mf-input" style="margin-top: 10px;" placeholder="Password Proxy (Opzionale)" oninput="updateFluxStream()">
                        </div>
                        <div class="control-row" style="margin-top:15px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top:15px;">
                            <div class="control-info">
                                <div class="control-title">
                                    <i class="fas fa-user-shield" style="color: var(--primary)"></i> <span class="notranslate" translate="no">Debrid Proxy Ghost</span>
                                </div>
                                <span class="control-desc">Maschera IP a Debrid. Richiede URL sopra.</span>
                            </div>
                            <label class="switch"><input type="checkbox" id="proxyDebrid" onchange="updateFluxStream()"><span class="slider"></span></label>
                        </div>
                    </div>
                </div>

                <div class="col-right">
                    <div class="section-header" style="margin-top:0;">CENTRO DI CONTROLLO RICERCA</div>
            
                    <div class="filters-container">
                        <div class="spectrum-container" style="border-color: var(--secondary); background: linear-gradient(135deg, rgba(0, 5, 10, 0.6), rgba(112, 0, 255, 0.05)); margin-bottom: 20px;">
                           <div class="spectrum-header" style="color: var(--secondary); border-bottom: 1px solid rgba(112, 0, 255, 0.2); padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: flex-end;">
                                <span style="display: flex; align-items: center; gap: 10px; font-size: 1.2rem; white-space: nowrap;"><i class="fas fa-network-wired"></i> FLUX PRIORITY</span>
                                <span class="spectrum-desc" style="margin:0; text-align:right; font-size: 0.85rem; opacity: 0.7;">Scegli come ordinare i risultati.</span>
                            </div>
                            <div class="spectrum-grid" style="grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                                <div class="spec-btn active" id="sort_balanced" onclick="setSortMode('balanced')" style="border-color: var(--secondary);"> LEVIATHAN</div>
                                <div class="spec-btn" id="sort_resolution" onclick="setSortMode('resolution')" style="border-color: var(--secondary);"><i class="fas fa-eye"></i> RISOLUZIONE</div>
                                <div class="spec-btn" id="sort_size" onclick="setSortMode('size')" style="border-color: var(--secondary);"><i class="fas fa-hdd"></i> BITRATE</div>
                            </div>
                            <div id="flux-info-box" style="background: rgba(0,0,0,0.4); border-left: 3px solid var(--secondary); padding: 12px; border-radius: 0 8px 8px 0;">
                                <div id="flux-title" style="color: #fff; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1rem; margin-bottom: 4px; text-transform: uppercase;">
                                    <i class="fas fa-info-circle"></i> MODALIT: LEVIATHAN (Consigliata)
                                </div>
                                <div id="flux-desc" style="color: var(--text-dim); font-size: 0.9rem; line-height: 1.4;">
                                    L'algoritmo standard di Leviathan. Cerca il bilanciamento perfetto tra qualit, popolarit del file e velocit. Ideale per l'uso quotidiano.
                                </div>
                            </div>
                            <input type="hidden" id="sortMode" value="balanced">
                        </div>
                        
                        <div class="filter-unit">
                            <div class="unit-header">
                                <div class="unit-title"><i class="fas fa-layer-group" style="color:var(--primary)"></i> UNIT ELABORAZIONE SEGNALE</div>
                            </div>

                            <div class="filter-row">
                                <div class="header-with-desc">
                                    <span class="f-label">FILTRO RISOLUZIONE (Escludi)</span>
                                    <span class="f-desc-mini">Rimuove le qualit selezionate dai risultati.</span>
                                </div>
                                <div class="spectrum-grid">
                                    <div class="spec-btn active" id="btn_4k" onclick="toggleSpectrum('btn_4k')">4K UHD</div>
                                    <div class="spec-btn active" id="btn_1080" onclick="toggleSpectrum('btn_1080')">1080p</div>
                                    <div class="spec-btn active" id="btn_720" onclick="toggleSpectrum('btn_720')">720p / HD</div>
                                    <div class="spec-btn active" id="btn_sd" onclick="toggleSpectrum('btn_sd')">SD/CAM</div>
                                </div>
                            </div>

                            <div class="filter-row">
                                <div class="header-with-desc">
                                    <span class="f-label">LIMITATORE PESO (Max GB)</span>
                                    <span class="f-desc-mini">Filtra i file che superano la dimensione impostata.</span>
                                </div>
                                <div class="gate-integrated limiter-style" id="sizeWrapper">
                                    <div class="gate-val-box" id="sizeDisplay"></div>
                                    <input type="range" min="0" max="100" step="1" value="0" class="gate-slider-new" id="maxSizeSlider" oninput="updateSizeVal(this.value); updateFluxStream()">
                                </div>
                            </div>

                            <div class="filter-row">
                                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:5px;">
                                    <div class="header-with-desc" style="margin-bottom:0;">
                                        <span class="f-label" style="margin:0;">SIGNAL GATE</span>
                                        <span class="f-desc-mini">Imposta un tetto massimo di risultati per ogni risoluzione.</span>
                                    </div>
                                    <label class="switch" style="transform:scale(0.8); margin:0;"><input type="checkbox" id="gateActive" onchange="toggleGate(); updateFluxStream()"><span class="slider"></span></label>
                                </div>
                                <div class="gate-integrated" id="gateWrapper">
                                    <div class="gate-val-box" id="gateDisplay"></div>
                                    <input type="range" min="1" max="20" value="5" class="gate-slider-new" id="gateSlider" oninput="updateGateVal(this.value); updateFluxStream()">
                                </div>
                            </div>
                        </div>

                        <div class="aux-grid">
                            <div class="aux-card active" id="card_audio">
                                <div class="aux-header">
                                    <i class="fas fa-globe-americas aux-icon"></i><span>LINGUA & AUDIO</span>
                                </div>
                                <div class="aux-desc" style="margin-bottom: 5px;">
                                    Seleziona il protocollo linguistico di ricerca.
                                </div>
                                
                                <div class="select-wrapper">
                                    <select id="langMode" class="cyber-select" onchange="updateFluxStream()">
                                        <option value="ita" selected> ITALIANO (STRICT)</option>
                                        <option value="all"> HYBRID (ITA + ENG)</option>
                                        <option value="eng"> ENGLISH (NO ITA)</option>
                                    </select>
                                    <div class="select-arrow"></div>
                                </div>
                            </div>
                        
                            <div class="aux-card aio-card" id="card_aio">
                                <div class="aux-header">
                                    <i class="fas fa-microchip aux-icon"></i><span>Core AIO</span>
                                </div>
                                <div class="aux-desc">Ottimizza la lista risultati specificamente per l'addon <strong>AIOStreams</strong>.</div>
                                <label class="cyber-switch-container">
                                    <input type="checkbox" id="aiostreams_mode" onchange="toggleAuxCard('card_aio'); toggleAIOLock(); updateFluxStream()">
                                    <span class="cs-fill"></span>
                                    <span class="cs-label cs-label-off">STANDBY</span>
                                    <span class="cs-separator"></span>
                                    <span class="cs-label cs-label-on">ACTIVE</span>
                                </label>
                            </div>
                        
                            <div class="aux-card cine-card" id="card_trailer">
                                <div class="aux-header">
                                    <i class="fas fa-film aux-icon"></i><span>Cine Mode</span>
                                </div>
                                <div class="aux-desc">Avvia automaticamente un trailer cinematografico prima dello streaming.</div>
                                <label class="cyber-switch-container">
                                    <input type="checkbox" id="enableTrailers" onchange="toggleAuxCard('card_trailer'); updateFluxStream()">
                                    <span class="cs-fill"></span>
                                    <span class="cs-label cs-label-off">OFF</span>
                                    <span class="cs-separator"></span>
                                    <span class="cs-label cs-label-on">TRAILER</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visual-core-hero">
                
                <div class="aio-lock-overlay" id="aioLockOverlay" onclick="triggerAIODenied()">
                    <i class="fas fa-lock lock-icon"></i>
                    <div class="lock-msg">OVERRIDDEN BY AIO CORE</div>
                    <div style="color:#aaa; font-size:0.9rem; margin-top:5px;">Disabilita "Compatibilit AIO" per sbloccare le skin.</div>
                </div>

                <div class="spectrum-header" style="margin-bottom:20px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px;">
                    <span style="display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-palette" style="color:var(--primary)"></i> FORMATTER PROTOCOL // VISUAL CORE
                    </span>
                    <span class="spectrum-desc" style="text-align:right;">Personalizza l'aspetto dei risultati.</span>
                </div>

                <div class="preview-terminal" id="prevTerminal">
                    <div class="recalc-overlay" id="recalcLayer">
                        <div class="recalc-text"><i class="fas fa-cog fa-spin"></i> UPDATING CORE...</div>
                    </div>

                    <div class="preview-header">
                        <span><i class="fas fa-satellite-dish"></i> LIVE SIGNAL PREVIEW</span>
                        <span id="prev-mode-label">LEVIATHAN</span>
                    </div>
                    <div class="stremio-mock-row">
                        <div class="mock-poster"><i class="fas fa-image"></i></div>
                        <div class="mock-content">
                            <div class="mock-title" id="prev-name">   </div>

                            <div class="mock-info" id="prev-desc">   
   x  +
  ITA  |   TrueHD 7.1
 64.20 GB  |   1337
 1337x |  </div>
                        </div>
                    </div>
                </div>

                <div class="skin-selector-container" id="visualCoreContainer">
                    <div class="skin-btn active" id="skin_leviathan" onclick="selectSkin('leviathan')">
                        <span class="skin-icon"></span><span class="skin-name">Leviathan</span>
                    </div>
                    <div class="skin-btn" id="skin_complex" onclick="selectSkin('complex')">
                        <span class="skin-icon"></span><span class="skin-name">Template</span>
                    </div>
                    <div class="skin-btn" id="skin_android" onclick="selectSkin('android')">
                        <span class="skin-icon"></span><span class="skin-name">Android TV</span>
                    </div>
                    <div class="skin-btn" id="skin_picture" onclick="selectSkin('picture')">
                        <span class="skin-icon"></span><span class="skin-name">Picture</span>
                    </div>
                    <div class="skin-btn" id="skin_lev2" onclick="selectSkin('lev2')">
                        <span class="skin-icon"></span><span class="skin-name">Architect</span>
                    </div>
                    <div class="skin-btn" id="skin_fra" onclick="selectSkin('fra')">
                        <span class="skin-icon"></span><span class="skin-name">Horizon</span>
                    </div>
                    <div class="skin-btn" id="skin_comet" onclick="selectSkin('comet')">
                        <span class="skin-icon"></span><span class="skin-name">Comet</span>
                    </div>
                    <div class="skin-btn" id="skin_stremio_ita" onclick="selectSkin('stremio_ita')">
                        <span class="skin-icon"></span><span class="skin-name">ITA Mod</span>
                    </div>
                    <div class="skin-btn" id="skin_dav" onclick="selectSkin('dav')">
                        <span class="skin-icon"></span><span class="skin-name">Datastream</span>
                    </div>
                    <div class="skin-btn" id="skin_pri" onclick="selectSkin('pri')">
                        <span class="skin-icon"></span><span class="skin-name">Eclipse</span>
                    </div>
                    <div class="skin-btn" id="skin_and" onclick="selectSkin('and')">
                        <span class="skin-icon"></span><span class="skin-name">Matrix</span>
                    </div>
                    <div class="skin-btn" id="skin_lad" onclick="selectSkin('lad')">
                        <span class="skin-icon"></span><span class="skin-name">Compact</span>
                    </div>
                     <div class="skin-btn" id="skin_torrentio" onclick="selectSkin('torrentio')">
                        <span class="skin-icon"></span><span class="skin-name">Torrentio</span>
                    </div>
                    <div class="skin-btn" id="skin_vertical" onclick="selectSkin('vertical')">
                        <span class="skin-icon"></span><span class="skin-name">Vertical</span>
                    </div>
                    <div class="skin-btn" id="skin_custom" onclick="selectSkin('custom')">
                        <span class="skin-icon"></span><span class="skin-name">Custom</span>
                    </div>
                </div>
                <input type="hidden" id="selectedSkin" value="leviathan">

                <div class="custom-area" id="customSkinArea">
                    <input type="text" class="custom-input" id="customTemplate" placeholder="Lev {quality} ||| {title} - {size}" style="padding:15px; font-size:1rem;" oninput="updateCustomPreview()" disabled>
                    <div class="custom-helper">
                        <strong>Vars:</strong> <code>{title}</code> <code>{quality}</code> <code>{size}</code> <code>{source}</code> <code>{audio}</code> <code>{lang}</code> <code>{service}</code><br>
                        Usa <code>|||</code> per separare titolo e descrizione.
                    </div>
                </div>
            </div>

            <div class="action-area">
                <button class="btn-install" onclick="confirmInstall()">INIZIALIZZA SISTEMA <i class="fas fa-radiation"></i></button>
                <button class="btn-copy" onclick="copyLink()"><i class="fas fa-copy"></i><span id="copyText">COPIA LINK</span></button>
            </div>
            
            <div id="fluxTerminal" class="flux-terminal offline">
                <div class="flux-header">
                    <span class="flux-title"><span class="live-dot"></span>FLUX DATA STREAM // LINK GENERATOR</span>
                </div>
                <div class="flux-content">
                    <textarea id="generatedUrlBox" class="flux-input" readonly spellcheck="false">/// SYSTEM OFFLINE: WAITING FOR CONFIGURATION DATA ///</textarea>
                    <button class="flux-copy-btn" onclick="copyLink()" title="Copia Manuale"><i class="fas fa-copy"></i></button>
                </div>
            </div>

            <div class="footer-hub">
                <div class="hub-grid">
                    <a href="https://github.com/LUC4N3X/stremio-leviathan-addon" target="_blank" class="hub-card cmd-card">
                        <div class="cmd-visual">
                            <img src="https://i.ibb.co/gLkrjxXT/Whats-App-Image-2026-01-12-at-20-15-37.jpg" alt="LUC4N3X" class="cmd-img">
                            <div class="git-badge"><i class="fab fa-github"></i></div>
                        </div>
                        <div class="cmd-data">
                            <span class="cmd-role">Lead Developer</span>
                            <span class="cmd-nick">LUC4N3X</span>
                        </div>
                    </a>
            
                    <a href="https://ko-fi.com/luc4n3x" target="_blank" class="hub-card kofi-card">
                        <i class="fas fa-coffee kofi-icon"></i>
                        <div class="kofi-data">
                            <h4>OFFRIMI UN KO-FI</h4>
                            <span>Ricarica il Sistema</span>
                        </div>
                    </a>

                    <a href="https://stremio-addons.net/addons/leviathan" target="_blank" class="hub-card rate-card">
                        <i class="fas fa-star star-icon"></i>
                        <div class="rate-text">LASCIA UNA STELLA</div>
                    </a>
                </div>
            
                <div class="signature">
                    Codice forgiato negli abissi &bull; 2026
                </div>
            </div>
        </div>
    </div>
    
    <div class="sys-toast-container" id="toastArea"></div>

    <div class="modal-backdrop" id="installModal">
        <div class="modal-content">
            <div class="modal-title">CONFERMA PROTOCOLLO</div>
            <ul class="modal-list" id="modalSummary" style="list-style:none; padding:0; margin:0;"></ul>
            <div class="modal-btns">
                <button class="m-btn m-close" onclick="closeModal('installModal')">ANNULLA</button>
                <button class="m-btn m-go" onclick="proceedToInstall()">INSTALLA</button>
            </div>
        </div>
    </div>
    <div class="modal-backdrop" id="faqModal">
        <div class="modal-content">
            <div class="modal-title">DATABASE CENTRALE</div>
            <div id="faqList">
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-q">Come funziona? <i class="fas fa-chevron-down"></i></div>
                    <div class="faq-a"><span class="notranslate" translate="no">Leviathan</span> scansiona le profondit del web per trovare Torrent (tramite Debrid) e flussi <span class="notranslate" translate="no">StreamingCommunity</span> ad alta velocit.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-q">WebStreamr Fallback <i class="fas fa-chevron-down"></i></div>
                    <div class="faq-a"> un sistema di emergenza. Se Leviathan non trova alcun risultato Torrent o Web normale, attiva WebStreamr per cercare flussi HTTP diretti gratuiti (non Debrid) da database di riserva.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-q">MediaFlow & GuardaHD/GS <i class="fas fa-chevron-down"></i></div>
                    <div class="faq-a">I servizi come GuardaHD e GuardaSerie richiedono spesso un Proxy (MediaFlow) per funzionare correttamente su tutti i dispositivi.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-q">Cos' il Cache Builder? <i class="fas fa-chevron-down"></i></div>
                    <div class="faq-a">Se attivato, Leviathan mostrer anche i Torrent che NON sono ancora scaricati sui server Debrid. Cliccandoli, avvierai il download per te e per gli altri utenti.</div>
                </div>
            </div>
            <div class="modal-btns" style="margin-top:20px;">
                <button class="m-btn m-close" onclick="closeModal('faqModal')">CHIUDI DATABASE</button>
            </div>
        </div>
    </div>

    <script>
        function isMobileDevice() { return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1) || window.innerWidth < 768; }
        if (isMobileDevice()) {
            var css = '.ocean-bg, .particles, .main-wrapper, .modal-backdrop { display: none !important; }',
                head = document.head || document.getElementsByTagName('head')[0], style = document.createElement('style');
            head.appendChild(style); style.type = 'text/css'; style.appendChild(document.createTextNode(css));
            var version = new Date().getTime();
            var script = document.createElement('script'); script.src = '/smartphone.js?v=' + version; 
            script.onload = function() { if(typeof initMobileInterface === "function") initMobileInterface(); };
            script.onerror = function() {
                var backupScript = document.createElement('script'); backupScript.src = '../smartphone.js?v=' + version;
                backupScript.onload = function() { if(typeof initMobileInterface === "function") initMobileInterface(); };
                document.body.appendChild(backupScript);
            };
            document.body.appendChild(script);
            window.stopDesktopLogic = true;
        }

        function createParticles() {
            if(window.stopDesktopLogic) return;
            const container = document.getElementById('particles');
            const isMobile = window.innerWidth < 768;
            const count = isMobile ? 10 : 30; 
            container.innerHTML = '';
            for(let i=0; i < count; i++) {
                const p = document.createElement('div'); p.classList.add('particle');
                const size = Math.random() * 6 + 2;
                p.style.width = `${size}px`; p.style.height = `${size}px`; p.style.left = `${Math.random() * 100}%`;
                p.style.animationDuration = `${Math.random() * 15 + 10}s`;
                p.style.animationDelay = `-${Math.random() * 15}s`;
                const sway = Math.random() * 15 - 7.5; p.style.animationTimingFunction = 'ease-in-out';
                p.style.transform = `translateX(${sway}px)`; container.appendChild(p);
            }
        }

        function createLogoParticles() {
            const container = document.getElementById('logoParticles');
            const count = 8;
            container.innerHTML = '';
            for(let i=0; i < count; i++) {
                const p = document.createElement('div'); p.classList.add('logo-particle');
                const size = Math.random() * 4 + 2; 
                p.style.width = `${size}px`; p.style.height = `${size}px`; p.style.left = `${Math.random() * 100}%`;
                p.style.animationDuration = `${Math.random() * 10 + 5}s`; 
                p.style.animationDelay = `-${Math.random() * 10}s`;
                const sway = Math.random() * 8 - 4; p.style.animationTimingFunction = 'ease-in-out';
                p.style.transform = `translateX(${sway}px)`; container.appendChild(p);
            }
        }

        let currentService = 'rd';
        let currentSCQuality = 'all';

        // --- NEW TOAST SYSTEM ---
        function showToast(msg, type = 'info') {
            const container = document.getElementById('toastArea');
            if(!container) return;
            const el = document.createElement('div');
            el.className = `sys-toast ${type}`;
            
            let icon = 'fa-info-circle';
            if(type === 'warning') icon = 'fa-exclamation-triangle';
            if(type === 'error') icon = 'fa-bug';
            if(type === 'success') icon = 'fa-check-circle';
            
            el.innerHTML = `<i class="fas ${icon}"></i> <span>${msg}</span>`;
            container.appendChild(el);
            
            setTimeout(() => {
                el.classList.add('out');
                setTimeout(() => el.remove(), 300);
            }, 3000);
        }

        function triggerPreviewEffect() {
            const layer = document.getElementById('recalcLayer');
            if(!layer) return;
            layer.classList.add('visible');
            setTimeout(() => { layer.classList.remove('visible'); }, 400); 
        }

        function triggerAIODenied() {
            const overlay = document.getElementById('aioLockOverlay');
            if (overlay) {
                overlay.classList.remove('denied-anim');
                void overlay.offsetWidth;
                overlay.classList.add('denied-anim');
                showToast("AZIONE BLOCCATA DA AIO MODE", "warning");
            }
        }

        function toggleP2PStyle() {
             // Funzione non pi necessaria nel formato box separato,
             // ma mantenuta vuota per compatibilit se richiamata.
        }

        // --- SKINS LOGIC (PREVIEW) ---
        function toStylized(text, type = 'std') {
            if (!text) return "";
            text = String(text);
            const maps = {
                'bold': {
                    nums: {'0':'','1':'','2':'','3':'','4':'','5':'','6':'','7':'','8':'','9':''},
                    chars: {'A':'','B':'','C':'','D':'','E':'','F':'','G':'','H':'','I':'','J':'','K':'','L':'','M':'','N':'','O':'','P':'','Q':'','R':'','S':'','T':'','U':'','V':'','W':'','X':'','Y':'','Z':'','a':'','b':'','c':'','d':'','e':'','f':'','g':'','h':'','i':'','j':'','k':'','l':'','m':'','n':'','o':'','p':'','q':'','r':'','s':'','t':'','u':'','v':'','w':'','x':'','y':'','z':''}
                },
                'spaced': {
                    // Mappa speciale per testo spaziato
                    nums: {'0':'0','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9'},
                    chars: {'A':'','B':'','C':'','D':'','E':'','F':'','G':'','H':'','I':'','J':'','K':'','L':'','M':'','N':'','O':'','P':'','Q':'','R':'','S':'','T':'','U':'','V':'','W':'','X':'','Y':'','Z':''}
                },
                'small': {
                    nums: {'0':'0','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9'},
                    chars: {'A':'','B':'','C':'','D':'','E':'','F':'','G':'','H':'','I':'','J':'','K':'','L':'','M':'','N':'','O':'','P':'','Q':'','R':'','S':'','T':'','U':'','V':'','W':'','X':'x','Y':'','Z':'','a':'','b':'','c':'','d':'','e':'','f':'','g':'','h':'','i':'','j':'','k':'','l':'','m':'','n':'','o':'','p':'','q':'','r':'','s':'','t':'','u':'','v':'','w':'','x':'x','y':'','z':''}
                }
            };
            if (type === 'spaced') {
                return text.split('').map(c => {
                    const map = maps['spaced']; 
                    const char = (/[0-9]/.test(c) ? map.nums[c] : map.chars[c]) || c;
                    return char + ' ';
                }).join('').trim();
            }
            const map = maps[type] || maps['bold'];
            return text.split('').map(c => {
                if (/[0-9]/.test(c)) return map.nums[c] || c;
                return map.chars[c] || c;
            }).join('');
        }

        function selectSkin(skinId) {
            // CHECK AIO LOCK
            const isAIO = document.getElementById('aiostreams_mode').checked;
            if (isAIO && skinId !== 'leviathan') {
                triggerAIODenied();
                return;
            }

            document.querySelectorAll('.skin-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('skin_' + skinId).classList.add('active');
            document.getElementById('selectedSkin').value = skinId;
            document.getElementById('prev-mode-label').innerText = skinId.toUpperCase();
            
            const customArea = document.getElementById('customSkinArea');
            const customInput = document.getElementById('customTemplate');
            
            if(skinId === 'custom') {
                customArea.classList.add('show');
                customInput.disabled = false; 
                if(customInput.value.trim() === "") customInput.focus();
            } else {
                customArea.classList.remove('show');
                customInput.disabled = true; 
            }
            
            // NO EFFECT - INSTANT UPDATE FOR SKINS
            updatePreview(skinId);
            updateFluxStream();
        }

        function updateCustomPreview() { updatePreview('custom'); updateFluxStream(); }

        function updatePreview(skin) {
            // 1. Mock Data Arricchiti (Per simulare i dati che ha il formatter.js)
            const p = {
                // Dati base
                cleanName: "Dune Part Two",
                fileTitle: "Dune.Part.Two.2024.2160p.UHD.BluRay.x265.REMUX.DV.HDR.TrueHD.7.1.Atmos-LEVIATHAN.mkv",
                epTag: "", // Simuliamo un film
                
                // Specifiche
                quality: "4K",
                qDetails: "4K",
                codec: "HEVC",
                
                // Array tags puliti 
                cleanTags: ["Remux", "DV+HDR"], 
                videoTags: [" REMUX", " DV+HDR"], 
                
                // Audio e Lingua
                lang: " ITA",
                audioTag: "TrueHD",
                audioChannels: "7.1", 
                audioInfo: "TrueHD  7.1", 
                
                // Info File
                sizeString: "64.20 GB",
                seeders: 1337,
                seedersStr: " 1337",
                
                // Service & Source
                serviceTag: currentService === 'p2p' ? "P2P" : currentService.toUpperCase(), 
                displaySource: "1337x",
                sourceLine: "", 
                serviceIconTitle: ""
            };

            // Logica icone dinamiche (Simula formatStreamSelector)
            if (p.serviceTag === "RD") { p.serviceIconTitle = ""; }
            else if (p.serviceTag === "TB") { p.serviceIconTitle = ""; }
            else if (p.serviceTag === "P2P") { p.serviceIconTitle = ""; }
            
            p.sourceLine = `${p.serviceIconTitle} [${p.serviceTag}] ${p.displaySource}`;

            let name = "", desc = "";

            if (skin === 'leviathan') {
                // LOGICA AGGIORNATA AL NUOVO FORMATTER (Con Delfini, Tridenti e Bolle)

                const titleIcon = "";
                const techIcon = ""; // Tridente

                // 1. Calcolo Icona Servizio (Logica "Animali")
                let serviceIcon = ""; // Default P2P (Squalo)
                if (p.serviceTag === "RD") serviceIcon = "";      // RD = Delfino
                else if (p.serviceTag === "TB") serviceIcon = ""; // TB = Ancora
                else if (p.serviceTag === "AD") serviceIcon = ""; // AD = Conchiglia

                // 2. Icona Stato (Animale se cached, Clessidra se P2P non cached/download)
                // Nell'anteprima simuliamo che i debrid siano cached
                const isCached = ["RD", "TB", "AD"].includes(p.serviceTag);
                const statusIcon = isCached ? serviceIcon : "";

                // 3. Header: [Icona] [SERVICE_BOLD]  _SMALL
                const brandName = toStylized("LEVIATHAN", "small");
                const serviceStyled = toStylized(p.serviceTag, "bold");
                name = `${statusIcon} ${serviceStyled}  ${brandName}`;

                const lines = [];

                // RIGA 1: Titolo (Play + Titolo Bold + Ep)
                lines.push(`${titleIcon} ${toStylized(p.cleanName, "bold")} ${p.epTag}`);

                // RIGA 2: Tech (Tridente + Info Small)
                let techSpecs = [p.quality, ...p.cleanTags].filter(Boolean);
                techSpecs = [...new Set(techSpecs)]; 
                let techLine = techSpecs.map(t => toStylized(t, 'small')).join("  ");
                if (techLine) lines.push(`${techIcon} ${techLine}`);

                // RIGA 3: Lingua/Audio (Bolle )
                let cleanAudio = p.audioTag;
                let audioPart = [cleanAudio, p.audioChannels].filter(Boolean).join(" ");
                lines.push(` ${p.lang}  |   ${audioPart}`);

                // RIGA 4: Info File
                let fileInfo = ` ${p.sizeString}`;
                if (p.seedersStr) fileInfo += `  |  ${p.seedersStr}`;
                lines.push(fileInfo);

                // RIGA 5: Sorgente e Gruppo
                let sourceRow = `${serviceIcon} ${p.displaySource}`;
                const styledGroup = toStylized("LEVIATHAN", 'small'); // Gruppo simulato
                sourceRow += ` |  ${styledGroup}`;
                lines.push(sourceRow);

                desc = lines.join("\n");
            }
            
            else if (skin === 'complex') {
                // NUOVO COMPLEX (TEMPLATE STYLE)
                name = ` 4K   64.20 GB`;
                desc = `  ITA  TrueHD  7.1\n 4K  HEVC  Remux  DV+HDR\n Leviathan  LEVIATHAN  1337x  [${p.serviceTag}]\n ${p.cleanName}`;
            }

            else if (skin === 'android') {
                // NUOVO ANDROID TV
                name = `4K | DV | ${p.serviceTag}`;
                desc = ` HEVC\n TrueHD 7.1\n 1337x\n ITA\n${p.fileTitle}`;
            }

            else if (skin === 'picture') {
                // NUOVO PICTURE (JURASSIC STYLE)
                name = ` UHD HDR ATMOS 4K`;
                desc = ` ${p.cleanName}\n 4K  DV | HDR\n TrueHD  7.1\n Blu-ray Remux\n 64.20 GB\n Blu-ray Remux T1 (LEVIATHAN)\n Comet ${p.serviceTag}`;
            }

			else if (skin === 'lev2') {
                // styleLeviathanTwo
                const levText = toStylized("LEVIATHAN", "small");
                name = ` ${levText} ${p.serviceIconTitle}  ${p.quality}`;
                
                const lines = [];
                lines.push(` ${toStylized(p.cleanName, "bold")}`);
                lines.push(` ${p.sizeString}  ${p.codec} ${p.cleanTags.join(" ")}`);
                lines.push(` ${p.audioTag} ${p.audioChannels}  ${p.lang}`);
                lines.push(` ${p.sourceLine}`);
                desc = lines.join("\n");
            }
            else if (skin === 'fra') {
                name = ` Leviathan 4K`;
                desc = `  ${p.cleanName}\n   ITA  TrueHD\n  ${p.serviceTag}  ${p.displaySource}\n  4K  ${p.cleanTags.join('  ')}\n  ${p.sizeString} /   1337x`;
            }
            else if (skin === 'comet') {
                name = `[${p.serviceTag} ]\nLeviathan\n4K`;
                desc = ` ${p.cleanName}\n HEVC  ${p.cleanTags.join('  ')} | TrueHD\n ${p.displaySource}\n ${p.sizeString}  1337\n ITA`;
            }
            else if (skin === 'stremio_ita') {
                name = ` Leviathan 4K`;
                desc = `  ${p.cleanName}\n  ita  eng\n  ${p.serviceTag}  ${p.displaySource}\n  4K  HEVC  ${p.cleanTags.join('  ')}\n  ${p.sizeString} /   1337x\n  TrueHD  7.1`;
            }
            else if (skin === 'dav') {
                name = ` 4K UHD HEVC`;
                desc = ` ${p.cleanName}\n TrueHD 7.1 |  HEVC\n ITA |  ${p.sizeString}\n 1337 Seeds |  ${p.displaySource}\n${p.serviceIconTitle} Leviathan  ${p.serviceTag}\n ${p.fileTitle}`;
            }
            else if (skin === 'and') {
                name = ` ${p.cleanName}`;
                desc = `4K \n         \nLingue: \nSpecifiche: 4K |  ${p.cleanTags.join(' ')} |  TrueHD\n         \n ${p.sizeString} |  ${p.serviceTag} |  Leviathan`;
            }
            else if (skin === 'lad') {
                name = ` 4K ${p.serviceTag}`;
                desc = ` ${p.cleanName}\n Movie\n 4K  HEVC  TrueHD\n ${p.sizeString}   Leviathan\n `;
            }
            else if (skin === 'pri') {
                name = `[${p.serviceTag}]\n4KUHD\n[Leviathan]`;
                desc = ` ${p.cleanName}\n${p.cleanTags.join(' ')}\n TrueHD |  7.1 |  ITA\n ${p.sizeString} |  ${p.displaySource}\n  ${p.fileTitle} `;
            }
             else if (skin === 'torrentio') {
                name = `[${p.serviceTag}]\n${p.quality}`;
                const lines = [];
                lines.push(` ${p.fileTitle}`);
                lines.push(` ${p.sizeString}  ${p.seeders}`);
                lines.push(` ${p.displaySource}`);
                
                // Mocking clean language logic like formatter.js
                let cleanLang = p.lang.replace(/[\u{1F1E6}-\u{1F1FF}]{2}/gu, "").trim(); 
                if (!cleanLang.replace(/[^a-zA-Z]/g, "")) cleanLang = p.lang;
                lines.push(` ${cleanLang}`);
                
                desc = lines.join("\n");
            }
            else if (skin === 'vertical') {
                const isCached = ["RD", "TB", "AD"].includes(p.serviceTag);
                const cacheIcon = isCached ? "" : "";
                name = ` Leviathan ${p.quality} ${cacheIcon} Cached`;
                const lines = [];
                lines.push(` ${p.cleanName}`);
                const videoInfo = p.cleanTags.length > 0 ? ` WEB-DL  ${p.cleanTags[0]}` : ` WEB-DL`;
                lines.push(videoInfo);
                lines.push(` ${p.codec}`);
                lines.push(` ${p.audioTag} (${p.audioChannels})`);
                lines.push(` ${p.lang}`);
                lines.push(` ${p.sizeString}`);
                desc = lines.join("\n");
            }
            else if (skin === 'custom') {
                let tpl = document.getElementById('customTemplate').value;
                if(!tpl || tpl.trim() === "") tpl = "Lev {quality} ||| {title} - {size}";
                
                tpl = tpl.replace("{title}", p.cleanName).replace("{quality}", p.quality)
                         .replace("{size}", p.sizeString).replace("{source}", p.displaySource)
                         .replace("{service}", p.serviceTag).replace("{lang}", "ITA")
                         .replace("{audio}", p.audioInfo).replace(/\\n/g, "\n");
                
                if (tpl.includes("|||")) {
                    const parts = tpl.split("|||");
                    name = parts[0].trim();
                    desc = parts[1].trim();
                } else {
                    name = `Leviathan ${p.serviceTag}\n${p.quality}`;
                    desc = tpl;
                }
            }
            document.getElementById('prev-name').innerText = name;
            document.getElementById('prev-desc').innerText = desc;
        }

        function toggleAIOLock() {
            const isAIO = document.getElementById('aiostreams_mode').checked;
            const skinContainer = document.getElementById('visualCoreContainer');
            const customArea = document.getElementById('customSkinArea');
            const overlay = document.getElementById('aioLockOverlay');
            if (isAIO) {
                skinContainer.classList.add('disabled-core');
                customArea.classList.add('disabled-core');
                overlay.style.display = 'flex';
                selectSkin('leviathan'); 
                showToast("AIO MODE ATTIVO: SKIN RESETTATE", "info");
            } else {
                skinContainer.classList.remove('disabled-core');
                customArea.classList.remove('disabled-core');
                overlay.style.display = 'none';
            }
        }

        function setSortMode(mode) {
            document.getElementById('sortMode').value = mode;
            const infoData = {
                'balanced': { title: "MODALIT: LEVIATHAN (Consigliata)", desc: "L'algoritmo standard di Leviathan. Cerca il bilanciamento perfetto tra qualit, popolarit del file e velocit. Ideale per l'uso quotidiano." },
                'resolution': { title: "MODALIT: PRIORIT RISOLUZIONE", desc: "Gerarchia visiva rigida. I risultati 4K appariranno sempre per primi, seguiti dai 1080p e infine 720p, indipendentemente dalla grandezza del file." },
                'size': { title: "MODALIT: PRIORIT BITRATE (PESO)", desc: "Ordina per grandezza del file (dal pi grande al pi piccolo). Ideale per chi vuole il massimo bitrate possibile e ha una connessione molto veloce." }
            };
            ['balanced', 'resolution', 'size'].forEach(m => {
                const btn = document.getElementById('sort_' + m);
                if (m === mode) {
                    btn.classList.add('active'); btn.style.color = "#fff"; btn.style.boxShadow = "0 0 10px rgba(112, 0, 255, 0.2)";
                    btn.style.background = "linear-gradient(135deg, rgba(112, 0, 255, 0.15), transparent)";
                } else {
                    btn.classList.remove('active'); btn.style.color = "var(--text-dim)"; btn.style.boxShadow = "none"; btn.style.background = "rgba(0, 242, 255, 0.05)";
                }
            });
            const infoBox = document.getElementById('flux-info-box');
            if(infoBox) {
                infoBox.style.opacity = '0.5';
                setTimeout(() => {
                    document.getElementById('flux-title').innerHTML = '<i class="fas fa-info-circle"></i> ' + infoData[mode].title;
                    document.getElementById('flux-desc').innerText = infoData[mode].desc;
                    infoBox.style.opacity = '1';
                }, 150);
            }
            updateFluxStream();
        }

        function toggleSpectrum(id) {
            const el = document.getElementById(id);
            const isExcluded = el.classList.contains('excluded');
            
            if (isExcluded) { 
                el.classList.remove('excluded'); el.classList.add('active'); 
            } else { 
                el.classList.remove('active'); el.classList.add('excluded'); 
                triggerPreviewEffect(); 
            }
            updateFluxStream();
        }
        
        function setSpecState(btnId, isExcluded) {
            const el = document.getElementById(btnId);
            if(isExcluded) { el.classList.remove('active'); el.classList.add('excluded'); } 
            else { el.classList.add('active'); el.classList.remove('excluded'); }
        }

        function checkWebVisibility() {
            const sc = document.getElementById('enableVix').checked;
            const ghd = document.getElementById('enableGhd').checked;
            const gs = document.getElementById('enableGs').checked;
            const aw = document.getElementById('enableAnimeWorld').checked; // AGGIUNTO
            const qContainer = document.getElementById('scQualityContainer');
            if(qContainer) qContainer.style.display = sc ? 'block' : 'none';
            const pRow = document.getElementById('webPriorityRow');
            if(pRow) {
                // Aggiunto controllo AW
                if(sc || ghd || gs || aw) { pRow.style.display = 'flex'; pRow.style.animation = 'fadeInRow 0.3s ease'; } 
                else { pRow.style.display = 'none'; }
            }
        }

        function setSCQuality(val) {
            currentSCQuality = val;
            document.querySelectorAll('.q-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btnQ_' + val).classList.add('active');
            updateFluxStream();
        }

        function toggleGate() {
            const active = document.getElementById('gateActive').checked;
            const wrap = document.getElementById('gateWrapper');
            const display = document.getElementById('gateDisplay');
            const slider = document.getElementById('gateSlider');
            if (active) { 
                wrap.classList.add('active'); display.innerText = slider.value; 
                showToast("SIGNAL GATE ATTIVO", "warning");
            } 
            else { wrap.classList.remove('active'); display.innerText = ""; }
            updateLinkModalContent();
        }

        function updateGateVal(val) { document.getElementById('gateDisplay').innerText = val; }
        
        function updateSizeVal(val) { 
            const display = document.getElementById('sizeDisplay');
            display.innerText = (val == 0) ? "" : val;
        }

        function toggleAuxCard(cardId) {
            const card = document.getElementById(cardId);
            const checkbox = card.querySelector('input[type="checkbox"]');
            if (checkbox.checked) card.classList.add('active');
            else card.classList.remove('active');
        }

        function clearError(input) { input.classList.remove('input-error'); }
        function toggleFaq(el) { el.classList.toggle('open'); }

        window.onload = function() {
            if(window.stopDesktopLogic) return;
            createParticles(); createLogoParticles(); window.onresize = createParticles;
            try {
                const pathParts = window.location.pathname.split('/');
                if (pathParts.length >= 2 && pathParts[1].length > 10) {
                    const config = JSON.parse(atob(pathParts[1]));
                    if (config.key) document.getElementById('apiKey').value = config.key;
                    if (config.tmdb) document.getElementById('tmdbKey').value = config.tmdb;
                    if (config.service) {
                        selectService(config.service, true);
                    } else if (config.filters && config.filters.enableP2P) {
                        selectService('p2p', true);
                    }
                    if (config.formatter) selectSkin(config.formatter); 
                    if (config.customTemplate) document.getElementById('customTemplate').value = config.customTemplate;
                    if (config.aiostreams_mode) {
                        document.getElementById('aiostreams_mode').checked = true;
                        document.getElementById('card_aio').classList.add('active');
                        toggleAIOLock();
                    }
                    if (config.mediaflow) {
                        document.getElementById('mfUrl').value = config.mediaflow.url || "";
                        document.getElementById('mfPass').value = config.mediaflow.pass || "";
                        document.getElementById('proxyDebrid').checked = config.mediaflow.proxyDebrid || false;
                    }
                    if (config.filters) {
                        const langMode = config.filters.language || (config.filters.allowEng ? 'all' : 'ita'); 
                        document.getElementById('langMode').value = langMode;
                        
                        document.getElementById('enableVix').checked = config.filters.enableVix || false;
                        document.getElementById('vixLast').checked = config.filters.vixLast || false;
                        document.getElementById('enableGhd').checked = config.filters.enableGhd || false;
                        document.getElementById('enableGs').checked = config.filters.enableGs || false;
                        // AGGIUNTO LOADER ANIMEWORLD
                        document.getElementById('enableAnimeWorld').checked = config.filters.enableAnimeWorld || false;

                        document.getElementById('enableWebStreamr').checked = config.filters.enableWebStreamr !== false;
                        document.getElementById('enableTrailers').checked = config.filters.enableTrailers || false; 
                        
                        setSpecState('btn_4k', config.filters.no4k);
                        setSpecState('btn_1080', config.filters.no1080);
                        setSpecState('btn_720', config.filters.no720);
                        setSpecState('btn_sd', config.filters.noScr || config.filters.noCam);
                        if(config.filters.scQuality) setSCQuality(config.filters.scQuality); else setSCQuality('all');
                        if (config.filters.maxPerQuality && config.filters.maxPerQuality > 0) {
                            document.getElementById('gateActive').checked = true;
                            document.getElementById('gateSlider').value = config.filters.maxPerQuality;
                            toggleGate(); 
                        }
                        if (config.filters.maxSizeGB) {
                            document.getElementById('maxSizeSlider').value = config.filters.maxSizeGB;
                            updateSizeVal(config.filters.maxSizeGB);
                        } else {
                            document.getElementById('maxSizeSlider').value = 0;
                            updateSizeVal(0);
                        }
                        if (document.getElementById('enableTrailers').checked) document.getElementById('card_trailer').classList.add('active');
                        if (config.sort) setSortMode(config.sort); else setSortMode('balanced');
                    }
                    checkWebVisibility();
                    // FORCE UPDATE PREVIEW TO FIX DEFAULT LOAD STATE
                    updatePreview(document.getElementById('selectedSkin').value);
                    updateFluxStream();
                } else {
                     // Caso di default senza config: forza l'anteprima corretta
                     updatePreview('leviathan');
                }
            } catch (e) {
                // In caso di errore nel parsing, comunque aggiorna l'anteprima
                updatePreview('leviathan');
            }
        };

        function selectService(service, skipReset = false) {
            if(currentService !== service && !skipReset) { document.getElementById('apiKey').value = ""; }
            currentService = service;
            document.querySelectorAll('.service-tab').forEach(el => {
                el.classList.remove('active');
                el.classList.remove('p2p-active');
            });
            const tabs = document.querySelectorAll('.service-tab');
            const links = { 
                'rd': ['https://real-debrid.com/apitoken', 'INCOLLA KEY REAL-DEBRID'], 
                'tb': ['https://torbox.app/settings', 'INCOLLA KEY TORBOX'] 
            };
            const apiInput = document.getElementById('apiKey');
            const apiLink = document.getElementById('apiLink');

            if (service === 'rd') {
                tabs[0].classList.add('active');
                apiInput.disabled = false;
                apiLink.href = links[service][0];
                apiInput.placeholder = links[service][1];
                apiLink.style.pointerEvents = 'auto';
                apiLink.style.opacity = '1';
            }
            if (service === 'tb') {
                tabs[1].classList.add('active');
                apiInput.disabled = false;
                apiLink.href = links[service][0];
                apiInput.placeholder = links[service][1];
                apiLink.style.pointerEvents = 'auto';
                apiLink.style.opacity = '1';
            }
            if (service === 'p2p') {
                tabs[2].classList.add('active');
                tabs[2].classList.add('p2p-active');
                apiInput.disabled = true;
                apiInput.placeholder = "NESSUNA API KEY RICHIESTA (P2P)";
                apiInput.value = "";
                apiInput.classList.remove('input-error');
                apiLink.style.pointerEvents = 'none';
                apiLink.style.opacity = '0.5';
                showToast("MODALIT P2P ATTIVA: IP VISIBILE", "warning");
            }
            
            updatePreview(document.getElementById('selectedSkin').value);
            updateFluxStream();
        }

        function validateInputs() {
            let isValid = true;
            const scActive = document.getElementById('enableVix').checked;
            const ghdActive = document.getElementById('enableGhd').checked;
            const gsActive = document.getElementById('enableGs').checked;
            const awActive = document.getElementById('enableAnimeWorld').checked; // AGGIUNTO
            const isP2P = currentService === 'p2p';
            // Aggiunto awActive al controllo
            const isWebEnabled = scActive || ghdActive || gsActive || awActive || isP2P; 
            
            const el = document.getElementById('apiKey');
            const value = el.value.trim();

            if (!isP2P && !value && !isWebEnabled) { 
                el.classList.add('input-error'); 
                isValid = false; 
            } else { 
                el.classList.remove('input-error'); 
            }
            return isValid;
        }

        function getConfigObject() {
            const gateActive = document.getElementById('gateActive').checked;
            const gateVal = parseInt(document.getElementById('gateSlider').value);
            const sizeVal = parseInt(document.getElementById('maxSizeSlider').value);
            const lang = document.getElementById('langMode').value;
            const isP2P = currentService === 'p2p';

            return {
                service: isP2P ? '' : currentService,
                key: document.getElementById('apiKey').value.trim(),
                tmdb: document.getElementById('tmdbKey').value.trim(),
                sort: document.getElementById('sortMode').value,
                formatter: document.getElementById('selectedSkin').value,
                customTemplate: document.getElementById('customTemplate').value,
                aiostreams_mode: document.getElementById('aiostreams_mode').checked,
                mediaflow: {
                    url: document.getElementById('mfUrl').value.trim().replace(/\/$/, ""),
                    pass: document.getElementById('mfPass').value.trim(),
                    proxyDebrid: document.getElementById('proxyDebrid').checked
                },
                filters: {
                    language: lang, 
                    allowEng: lang === 'all' || lang === 'eng',
                    enableP2P: isP2P, 
                    no4k: document.getElementById('btn_4k').classList.contains('excluded'),
                    no1080: document.getElementById('btn_1080').classList.contains('excluded'),
                    no720: document.getElementById('btn_720').classList.contains('excluded'),
                    noScr: document.getElementById('btn_sd').classList.contains('excluded'),
                    noCam: document.getElementById('btn_sd').classList.contains('excluded'),
                    enableVix: document.getElementById('enableVix').checked,
                    enableGhd: document.getElementById('enableGhd').checked,
                    enableGs: document.getElementById('enableGs').checked,
                    enableAnimeWorld: document.getElementById('enableAnimeWorld').checked, // AGGIUNTO
                    enableWebStreamr: document.getElementById('enableWebStreamr').checked,
                    enableTrailers: document.getElementById('enableTrailers').checked, 
                    vixLast: document.getElementById('vixLast').checked,
                    scQuality: currentSCQuality, 
                    maxPerQuality: gateActive ? gateVal : 0,
                    maxSizeGB: sizeVal > 0 ? sizeVal : null 
                }
            };
        }

        function getBaseManifestUrl() {
            if(!validateInputs()) return null;
            return `${window.location.host}/${btoa(JSON.stringify(getConfigObject()))}/manifest.json`;
        }
        
        function updateFluxStream() {
            const terminal = document.getElementById('fluxTerminal');
            const box = document.getElementById('generatedUrlBox');
            const url = getBaseManifestUrl();
            
            if(url) {
                const fullUrl = `${window.location.protocol}//${url}`;
                box.value = fullUrl;
                box.style.color = "var(--primary)";
                terminal.classList.remove('offline');
                terminal.classList.add('online');
            } else {
                box.value = "/// SYSTEM OFFLINE: WAITING FOR CONFIGURATION DATA ///\n[!] Inserisci API Key, Attiva P2P o Attiva Web";
                box.style.color = "var(--error)";
                terminal.classList.remove('online');
                terminal.classList.add('offline');
            }
        }

        function openFaqModal() { const m = document.getElementById('faqModal'); m.style.display = 'flex'; setTimeout(() => m.classList.add('show'), 10); }

        function confirmInstall() {
            if(!validateInputs()) { 
                showToast("ERRORE: CONFIGURAZIONE INCOMPLETA", "error");
                document.querySelector('.main-wrapper').scrollIntoView({ behavior: 'smooth' }); return; 
            }
            const c = getConfigObject();
            const list = document.getElementById('modalSummary');
            let scText = c.filters.enableVix ? 'ATTIVO' : 'NO';
            if (c.filters.enableVix) {
                if (c.filters.scQuality === '1080') scText += ' (1080p)';
                else if (c.filters.scQuality === '720') scText += ' (720p)';
                else scText += ' (Hybrid)';
            }
            let p2pText = c.filters.enableP2P ? 'ATTIVO ()' : 'DISATTIVATO';
            let ghdText = c.filters.enableGhd ? 'ATTIVO ' : 'NO';
            let gsText = c.filters.enableGs ? 'ATTIVO ' : 'NO';
            let awText = c.filters.enableAnimeWorld ? 'ATTIVO ' : 'NO'; // AGGIUNTO
            let webStreamrText = c.filters.enableWebStreamr ? 'ATTIVO ' : 'DISATTIVATO';
            let exclText = [];
            if(c.filters.no4k) exclText.push("4K");
            if(c.filters.no1080) exclText.push("1080p");
            if(c.filters.no720) exclText.push("720p");
            if(c.filters.noScr) exclText.push("SD/CAM");
            let spectrumStr = exclText.length > 0 ? `ESCLUSI: ${exclText.join(', ')}` : 'COMPLETO';
            let gateText = c.filters.maxPerQuality > 0 ? `MAX ${c.filters.maxPerQuality}` : 'ILLIMITATO';
            let sizeText = c.filters.maxSizeGB ? `${c.filters.maxSizeGB} GB` : 'ILLIMITATO';
            let sortText = "LEVIATHAN (Balanced)";
            if(c.sort === 'resolution') sortText = "RISOLUZIONE (4K/FHD)";
            if(c.sort === 'size') sortText = "BITRATE (Peso)";
            let trailerText = c.filters.enableTrailers ? 'ATTIVO ' : 'NO';
            let skinText = c.formatter.toUpperCase();
            
            let langText = "SOLO ITA ";
            if(c.filters.language === 'all') langText = "HYBRID (ITA+ENG) ";
            if(c.filters.language === 'eng') langText = "SOLO ENG (NO ITA) ";
            
            let serviceDisplay = c.service ? c.service.toUpperCase() : "NESSUNO (P2P/WEB)";
            if (c.filters.enableP2P && !c.service) serviceDisplay = "P2P MODE ";

            // AGGIORNATO CON ANIMEWORLD (AW)
            list.innerHTML = `
                <li>Servizio Debrid <span>${serviceDisplay}</span></li>
                <li>Visual Skin <span>${skinText}</span></li>
                <li>Swarm P2P <span>${p2pText}</span></li>
                <li>Sorgenti Web <span>SC: ${scText} | GHD: ${ghdText} | GS: ${gsText} | AW: ${awText}</span></li>
                <li>Fallback WebStreamr <span>${webStreamrText}</span></li>
                <li>Flux Priority <span>${sortText}</span></li>
                <li>Proxy Bridge <span>${c.mediaflow.url ? 'CONFIGURATO' : 'NON ATTIVO'}</span></li>
                <li>Proxy Ghost <span>${c.mediaflow.proxyDebrid ? 'ATTIVO' : 'NO'}</span></li>
                <li>Limite Dimensione <span>${sizeText}</span></li>
                <li>Filtro Qualit <span>${spectrumStr}</span></li>
                <li>Signal Gate <span>${gateText}</span></li>
                <li>Lingua Audio <span>${langText}</span></li>
                <li>Cinema Mode <span>${trailerText}</span></li>
            `;
            const m = document.getElementById('installModal'); m.style.display = 'flex'; setTimeout(() => m.classList.add('show'), 10);
        }

        function closeModal(id) {
            const m = document.getElementById(id); m.classList.remove('show');
            setTimeout(() => m.style.display = 'none', 300);
        }

        window.onclick = function(e) { if (e.target.classList.contains('modal-backdrop')) closeModal(e.target.id); }

        function proceedToInstall() { 
            const url = getBaseManifestUrl(); 
            if(url) {
                window.location.href = `stremio://${url}`; 
            }
        }

        async function copyLink() {
            if(!validateInputs()) { 
                showToast("ERRORE: CONFIGURAZIONE INCOMPLETA", "error");
                document.querySelector('.main-wrapper').scrollIntoView({ behavior: 'smooth' }); 
                return; 
            }

            const url = getBaseManifestUrl();
            if(url) {
                const fullUrl = `${window.location.protocol}//${url}`;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    try {
                        await navigator.clipboard.writeText(fullUrl);
                        triggerCopyAnimation();
                    } catch (err) { fallbackCopy(fullUrl); }
                } else { fallbackCopy(fullUrl); }
            }
        }

        function fallbackCopy(text) {
            try {
                const dummy = document.createElement("textarea");
                document.body.appendChild(dummy);
                dummy.value = text;
                dummy.select();
                dummy.setSelectionRange(0, 99999);
                document.execCommand("copy");
                document.body.removeChild(dummy);
                triggerCopyAnimation();
            } catch (e) { console.error("Copia automatica fallita.", e); }
        }

        function triggerCopyAnimation() {
            const t = document.getElementById('copyText');
            const old = t.innerText;
            t.innerText = "COPIATO!";
            t.style.color = "#00f2ff";
            showToast("LINK COPIATO NEGLI APPUNTI", "success");
            setTimeout(() => { t.innerText = old; t.style.color = ""; }, 2000);
        }
    </script>
</body>
</html>
